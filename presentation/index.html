<!DOCTYPE html><html lang="en"><head>
    <meta charset="utf-8">
<title>[DS] Presentation Mechanisms</title>
<meta name="description" content="Presentation Mechanisms for Distributed Systems">
<meta name="author" content="Giovanni Ciatto">
<meta name="apple-mobile-web-app-capable" content="yes">
<meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
<meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no"><link rel="stylesheet" href="/slides-module2/reveal-js/dist/reset.css">
<link rel="stylesheet" href="/slides-module2/reveal-js/dist/reveal.css">
  <link rel="stylesheet" href="/slides-module2/css/custom-theme.min.1b20742b97214d830a9aee59899723c921c39aabc30127443e315315207a1497.css" id="theme"><link rel="stylesheet" href="/slides-module2/highlight-js/solarized-dark.min.css">
<link href="https://fonts.googleapis.com/css?family=Roboto Mono" rel="stylesheet">
<link href="https://fonts.googleapis.com/css?family=Oxygen Mono" rel="stylesheet">
<link href="https://fonts.googleapis.com/css?family=Ubuntu Mono" rel="stylesheet">
<link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.1/dist/css/bootstrap.min.css" rel="stylesheet" integrity="sha384-4bw+/aepP/YC94hEpVNVgiZdgIC5+VKNBQNGCHeKRQN+PtmoHDEXuppvnDJzQIu9" crossorigin="anonymous">
<link href="https://cdn.jsdelivr.net/gh/DanySK/css-blur-animation/blur.css" rel="stylesheet" crossorigin="anonymous">
<script src="https://kit.fontawesome.com/81ac037be0.js" crossorigin="anonymous"></script>
<script type="text/javascript" src="https://unpkg.com/qr-code-styling@1.5.0/lib/qr-code-styling.js"></script>
<script src="https://unibo-fc-isi-ds.github.io/slides-module2//plantuml.js"></script>

  </head>
  <body>
    
    <div class="reveal">
      <div class="slides">
  

    <section><h1 id="presentation-mechanisms-for-distributed-systems">Presentation Mechanisms for Distributed Systems</h1>
<br>
<h2 id="hahahugoshortcode1s0hbhb">Distributes Systems — Module 2</h2>
<h3 id="hahahugoshortcode1s1hbhb">A.Y. 2024/2025</h3>
<h3 id="hahahugoshortcode1s2hbhb"><a href="mailto:giovanni.ciatto@unibo.it">Giovanni Ciatto</a></h3>
<br>
<br>
<p>Compiled on: 2024-10-08
 — <a href="?print-pdf&amp;pdfSeparateFragments=false"><i class="fa fa-print" aria-hidden="true"></i> printable version</a></p>
<p><a href="../#/toc"><i class="fa fa-undo" aria-hidden="true"></i> back to ToC</a></p>
</section><section>
<h2 id="context">Context</h2>
<ul>
<li>
<p>Nodes in distributed systems may be implemented in <em>different languages</em> (e.g. C, Java, Python, etc.)</p>
<ul>
<li>possibly running on <em>different platforms</em> (e.g. Python, JVM, Node, etc.) and <em>OS</em> (e.g. Windows, Linux, etc.)</li>
<li>possibly using <em>different data representations conventions</em> (e.g. big-endian, little-endian, etc.)</li>
</ul>
</li>
<li>
<p>As long as nodes comply to the <strong>same</strong> <em>communication protocols</em> and <em>patterns</em>, technological issues should <em>not</em> be a problem</p>
<ul>
<li><strong>presentation</strong> mechanisms are responsible for <em>representing</em> data in a <strong>common format</strong>
<ul>
<li>in order to <em>exchange</em> information smoothly between <em>heterogeneous</em> nodes</li>
</ul>
</li>
</ul>
</li>
<li>
<p>So far all examples have been in <em>Python</em> (for simplicity)…</p>
<ul>
<li>so, in practice, the “common format” didn’t need to be <em>explicitly</em> defined</li>
</ul>
</li>
<li>
<p>… but, in the <em>real world</em>, we need to <em>serialize</em> and <em>deserialize</em> data explicitly into/from a <em>common format</em></p>
<ul>
<li>this is the role of <strong>data interchange formats</strong>, such as:
<ul>
<li><a href="https://en.wikipedia.org/wiki/JSON">JavaScript Object Notation (JSON)</a> (<em>we will use this one</em>)</li>
<li><a href="https://en.wikipedia.org/wiki/YAML">Yet Another Markup Language (YAML)</a> (later renamed in “YAML Ain’t Markup Language”)</li>
<li><a href="https://en.wikipedia.org/wiki/XML">eXtensible Markup Language (XML)</a></li>
<li><a href="https://en.wikipedia.org/wiki/Type-length-value">Type–length–value (TLV)</a></li>
<li><a href="https://en.wikipedia.org/wiki/Protocol_Buffers">Protocol Buffers</a></li>
<li><a href="https://avro.apache.org/">Avro</a></li>
</ul>
</li>
</ul>
</li>
</ul>
</section><section>
<h2 id="content-of-the-lecture">Content of the lecture</h2>
<p>A lot of concepts to unpack here:</p>
<ol>
<li>
<p><strong>(De)Serialization</strong>: this is the <em>main goal</em> of this lecture</p>
<ul>
<li><em>serialization</em> is the process of converting an object into a stream of characters/bytes</li>
<li><em>deserialization</em> is the reverse process</li>
<li>both operations imply a <em>common</em> target/source <strong>data interchange format</strong> (e.g. JSON)</li>
<li>both operations are _<strong>unavoidable</strong> in distributed systems programming</li>
</ul>
</li>
<li>
<p><strong>Remote Procedure Call</strong> (RPC): this is a very common <em>interaction pattern</em> in distributed systems</p>
<ul>
<li>it allows a client program to <em>invoke</em> a procedure from a remote server</li>
<li>it implies <strong>(de)serializing</strong> <em>parameters</em> and <em>results</em> of the procedure</li>
<li>so it’s the perfect <em>example</em> to illustrate how (de)serialization is used <em>in practice</em></li>
</ul>
</li>
<li>
<p><strong>Authentication</strong>: this is another <em>common</em> concern in distributed systems</p>
<ul>
<li>it implies clients providing <em>credentials</em> to servers to <em>prove</em> their identity</li>
<li>it is commonly <em>implemented</em> by means of <em>RPC</em>…</li>
<li>… so it’s a good <em>example</em> to illustrate how RPC is used <em>in practice</em></li>
<li>this is <em>not</em> strictly related to (de)serialization, but it’s a <em>good</em> example of <em>RPC</em>, and it <em>exploits</em> (de)serialization a lot</li>
</ul>
</li>
</ol>
</section><section>


<section data-shortcode-section="">
<h1 id="information-representation-101">Information Representation 101</h1>
<h2 id="quick-and-practical-excursus">(quick and practical excursus)</h2>
</section><section>
<h2 id="information-representation-recap-pt-1">Information Representation Recap (pt. 1)</h2>
<ul>
<li>
<p>In electronic systems, information is represented as <em>binary data</em></p>
<ul>
<li>i.e. sequences of <em>0s</em> and <em>1s</em></li>
</ul>
</li>
<li>
<p>For many practical reasons, binary sequences are commonly grouped in <em>bytes</em></p>
<ul>
<li><em>byte</em> $\equiv$ <em>8 bits</em> $\equiv$ <em>2 hexadecimal digits</em></li>
<li>e.g. <code>0x00</code>$\equiv$ 0, <code>0x01</code> $\equiv$ 1, <code>0x02</code> $\equiv$ 2, …, <code>0xFF</code> $\equiv$ 255</li>
</ul>
</li>
<li>
<p>Sequences of <em>bytes</em> can be used to represent many <em>sorts</em> of data, via ad-hoc <strong>conventions</strong></p>
<ul>
<li>e.g. <em>ASCII</em> (for text): e.g. <code>0x41</code> $\equiv$ 45 $\equiv$ <code>A</code>  (cf. <a href="https://www.asciitable.com/">ASCII Table</a>)</li>
<li>e.g. <em>UTF-8</em> (for text): e.g. <code>0xC3A0</code> $\equiv$ 50080 $\equiv$ <code>à</code> (cf. <a href="https://www.utf8-chartable.de/">UTF-8 Table</a>)</li>
<li>e.g. <em>little-endian</em> (for 32-bit integers): e.g. <code>0x3000</code> $\equiv$ 3 (cf. <a href="https://en.wikipedia.org/wiki/Endianness">Endianness</a>)</li>
<li>e.g. <em>big-endian</em> (for 32-bit integers): e.g. <code>0x0003</code> $\equiv$ 3 (cf. <a href="https://en.wikipedia.org/wiki/Endianness">Endianness</a>)</li>
</ul>
</li>
<li>
<p>Conventions $\approx$ data interchange formats</p>
<ul>
<li>they define how <em>data</em> is <em>encoded</em> into <em>bytes</em></li>
<li>they define how <em>bytes</em> should be <em>decoded</em> into <em>data</em></li>
</ul>
</li>
</ul>
<blockquote>
<p><strong>The problem</strong>: most programming languages / platforms / OS use <em>different</em> conventions for representing data
<br> <strong>The solution</strong>: <em>agree</em> on the data format to use for <em>communication</em></p>
</blockquote>
<p>corollary: data interchange formats are an <strong>essential</strong> aspect of every interaction pattern / protocol</p>
</section><section>
<h2 id="two-broad-categories-of-data-interchange-formats">Two broad categories of data interchange formats</h2>
<ol>
<li>
<p><strong>Text-based</strong> formats: they rely on <em>characters</em> to represent data (<em>we will use these ones</em>)</p>
<ul>
<li>e.g. <em>JSON</em>, <em>YAML</em>, <em>XML</em></li>
<li><strong>human-readable</strong>, <em>easy to debug</em>, <em>easy to parse</em>, possibility to <em>manually</em> edit the data</li>
<li><em>verbose</em>, <em>inefficient</em> (in terms of space)</li>
<li>may require tricks to represent <em>binary</em> data (e.g. <em>escape sequences</em>, or <em>base64</em> encoding)</li>
</ul>
</li>
<li>
<p><strong>Binary</strong> formats: they rely on <em>bytes</em> to represent data</p>
<ul>
<li>e.g. <em>Protocol Buffers</em>, <em>Avro</em></li>
<li><em>compact</em>, <em>efficient</em> (in terms of space)</li>
<li><em>harder</em> to debug, <em>harder</em> to parse, <em>harder</em> to manually edit the data (commonly require <em>hex editors</em>)</li>
<li><em>natively</em> support <em>binary</em> data, but can represent <em>text</em> as well</li>
</ul>
</li>
</ol>
<blockquote>
<p>But aren’t <em>characters</em> just <em>bytes</em>? Why do we need <em>different</em> formats for <em>text</em> and <em>binary</em> data?</p>
</blockquote>
<ul>
<li>In practice, engineers may prioritize human-readability if saving space is not a concern
<ul>
<li>e.g. on the Web</li>
</ul>
</li>
</ul>
</section><section>
<h2 id="characters-vs-bytes-encoding">Characters vs Bytes: Encoding</h2>
<ul>
<li>
<p>Characters are <strong>equivalent</strong> to bytes, according to an <strong>encoding</strong> scheme</p>
<ul>
<li>e.g. <em>ASCII</em>, <em>UTF-8</em>, <em>UTF-16</em>, <em>ISO-8859-1</em>, etc.</li>
</ul>
</li>
<li>
<p><em>ASCII</em> is the <em>oldest</em> encoding scheme, where each character is represented by a <em>single</em> byte (but only 7 bits are used)</p>
<ul>
<li>e.g. <code>A</code> $\equiv$ <code>0x41</code>, <code>B</code> $\equiv$ <code>0x42</code>, …, <code>a</code> $\equiv$ <code>0x61</code>, <code>b</code> $\equiv$ <code>0x62</code>, …
(this is what strings are represented in <em>C</em> and <em>Python 2</em>)</li>
</ul>
</li>
<li>
<p><em>Unicode</em>: an abstract way to represent information, coming with three different encoding schemes:</p>
<ul>
<li>
<p><em>UTF-8</em> is the <em>most common</em> encoding scheme, where each character is represented by <em>1 to 4</em> bytes</p>
<ul>
<li>e.g. <code>A</code> $\equiv$ <code>0x41</code>, <code>B</code> $\equiv$ <code>0x42</code>, …, <code>à</code> $\equiv$ <code>0xC3A0</code>, <code>è</code> $\equiv$ <code>0xC3A8</code>, …
(this is what strings are represented in <em>Python 3</em>, and most modern programming languages)</li>
</ul>
</li>
<li>
<p><em>UTF-16</em> is another common encoding scheme, where each character is represented by <em>2 or 4</em> bytes</p>
<ul>
<li>e.g. <code>A</code> $\equiv$ <code>0x0041</code>, <code>B</code> $\equiv$ <code>0x0042</code>, …, <code>à</code> $\equiv$ <code>0x00E0</code>, <code>è</code> $\equiv$ <code>0x00E8</code>, …</li>
</ul>
</li>
<li>
<p><em>UTF-32</em> is another encoding scheme, where each character is represented by <em>4</em> bytes</p>
<ul>
<li>e.g. <code>A</code> $\equiv$ <code>0x00000041</code>, <code>B</code> $\equiv$ <code>0x00000042</code>, …, <code>à</code> $\equiv$ <code>0x000000E0</code>, <code>è</code> $\equiv$ <code>0x000000E8</code>, …</li>
</ul>
</li>
</ul>
</li>
<li>
<p><em>ISO-8859-1</em> is another encoding scheme, where each character is represented by a <em>single</em> byte</p>
<ul>
<li>e.g. <code>A</code> $\equiv$ <code>0x41</code>, <code>B</code> $\equiv$ <code>0x42</code>, …, <code>à</code> $\equiv$ <code>0xE0</code>, <code>è</code> $\equiv$ <code>0xE8</code>, …</li>
</ul>
</li>
</ul>
<blockquote>
<p><em>Notice</em> that most of these encoding schemes are <em>compatible</em> with <em>ASCII</em> (i.e. the first 128 characters are the same)
this is why inexperienced programmers <em>often</em> don’t <em>notice</em> the difference between encodings</p>
</blockquote>
</section><section>
<h2 id="encoding-in-python">Encoding in Python</h2>
<ul>
<li>
<p>Python comes with the following <em>built-in</em> types to represent sequences of characters and bytes:</p>
<ul>
<li><code>str</code> for <em>textual</em> data (uses <em>UTF-8</em> encoding in Python 3, <em>ASCII</em> in Python 2), literals are of the from <code>"..."</code> or <code>'''...'''</code></li>
<li><code>bytes</code>for <em>binary</em> data (similar to byte arrays in other languages), literals are of the form <code>b"..."</code> or <code>b'...'</code></li>
</ul>
</li>
<li>
<p>Python also comes with functions to convert between <em>bytes</em> and <em>strings</em>:</p>
<ul>
<li><code>str.encode(ENCODING)</code>: converts a string into a sequence of bytes using the specified <code>ENCODING</code></li>
<li><code>bytes.decode(ENCODING)</code>: converts a sequence of bytes into a string <code>ENCODING</code></li>
<li>in both cases, <code>ENCODING</code> is a string representing the encoding scheme to use (e.g. <code>"utf-8"</code>, <code>"ascii"</code>, etc.)</li>
<li>if not specified, the default encoding is used (e.g. <code>import sys; sys.getdefaultencoding()</code>)</li>
</ul>
</li>
</ul>
<div class="highlight"><pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="nohighlight" data-noescape=""><span style="display:flex;"><span><span style="color:#000">s</span> <span style="color:#ce5c00;font-weight:bold">=</span> <span style="color:#4e9a06">"À l'école, l'élève étudiait l'histoire de la Révolution française et les événements marquants de l'été 1789."</span>
</span></span><span style="display:flex;"><span><span style="color:#000">b</span> <span style="color:#ce5c00;font-weight:bold">=</span> <span style="color:#000">s</span><span style="color:#ce5c00;font-weight:bold">.</span><span style="color:#000">encode</span><span style="color:#000;font-weight:bold">(</span><span style="color:#4e9a06">'utf-8'</span><span style="color:#000;font-weight:bold">)</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#204a87">print</span><span style="color:#000;font-weight:bold">(</span><span style="color:#000">b</span><span style="color:#000;font-weight:bold">)</span> <span style="color:#8f5902;font-style:italic"># b"\xc3\x80 l'\xc3\xa9cole, l'\xc3\xa9l\xc3\xa8ve \xc3\xa9tudiait l'histoire de la R\xc3\xa9volution fran\xc3\xa7aise et les \xc3\xa9v\xc3\xa9nements marquants de l'\xc3\xa9t\xc3\xa9 1789."</span>
</span></span><span style="display:flex;"><span><span style="color:#204a87">print</span><span style="color:#000;font-weight:bold">(</span><span style="color:#000">b</span><span style="color:#ce5c00;font-weight:bold">.</span><span style="color:#000">decode</span><span style="color:#000;font-weight:bold">(</span><span style="color:#4e9a06">'utf-8'</span><span style="color:#000;font-weight:bold">))</span> <span style="color:#8f5902;font-style:italic"># "À l'école, l'élève étudiait l'histoire de la Révolution française et les événements marquants de l'été 1789."</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#204a87">print</span><span style="color:#000;font-weight:bold">(</span><span style="color:#000">b</span><span style="color:#ce5c00;font-weight:bold">.</span><span style="color:#000">decode</span><span style="color:#000;font-weight:bold">(</span><span style="color:#4e9a06">'ascii'</span><span style="color:#000;font-weight:bold">))</span> <span style="color:#8f5902;font-style:italic"># UnicodeDecodeError: 'ascii' codec can't decode byte 0xc3 in position 0: ordinal not in range(128)</span>
</span></span></code></pre></div></section><section>
<h2 id="escape-sequences">Escape sequences</h2>
<ul>
<li>
<p>When using textual encodings, there maybe situations where some characters <em>cannot</em> be <em>directly</em> represented/inserted in a string</p>
<ul>
<li>e.g. <em>control characters</em> (e.g. <code>\n</code>, <code>\t</code>, <code>\r</code>, etc.)</li>
<li>e.g. <em>non-printable characters</em> (e.g. <code>0x00</code>, <code>0x01</code>, etc.)</li>
</ul>
</li>
<li>
<p>Other than supporting encodings, most <em>programming</em> or <em>data representation languages</em> also support_</p>
<ul>
<li><strong>escape sequences</strong> $\approx$ sub-sequences of characters that represent a <em>single</em> character</li>
</ul>
</li>
<li>
<p>Most commonly:</p>
<ul>
<li>there is an <em>escape character</em> (commonly <code>\</code>) that <em>initiates</em> the escape sequence</li>
<li>what can follow the escape character is <em>technology-dependent</em>, but most languages support the following:
<ul>
<li><code>\n</code> $\equiv$ newline</li>
<li><code>\t</code> $\equiv$ tab</li>
<li><code>\r</code> $\equiv$ carriage return</li>
<li><code>\\</code> $\equiv$ backslash (the single <code>\</code> is the escape character, so you need <code>\\</code> to represent a single <code>\</code>)</li>
<li><code>\"</code> $\equiv$ double quote</li>
<li><code>\'</code> $\equiv$ single quote</li>
<li><code>\xHH</code> (or <code>\uHHHH</code>, or <code>\UHHHHHHHH</code>) $\equiv$ byte with hexadecimal value <code>HH</code> (or<code>HHHH</code>, or <code>HHHHHHHH</code>)</li>
</ul>
</li>
</ul>
</li>
<li>
<p>Two relevant operations:</p>
<ul>
<li><em>escaping</em>: converting a <em>character string</em> into another character string with <em>escape sequences</em> for non-printable characters</li>
<li><em>unescaping</em>: the other way around</li>
</ul>
</li>
</ul>
</section><section>
<h2 id="escape-sequences-in-python">Escape sequences in Python</h2>
<p>Function to <em>escape</em> strings:</p>
<div class="highlight"><pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="nohighlight" data-noescape=""><span style="display:flex;"><span><span style="color:#204a87;font-weight:bold">def</span> <span style="color:#000">escape</span><span style="color:#000;font-weight:bold">(</span><span style="color:#000">s</span><span style="color:#000;font-weight:bold">:</span> <span style="color:#204a87">str</span><span style="color:#000;font-weight:bold">)</span> <span style="color:#ce5c00;font-weight:bold">-&gt;</span> <span style="color:#204a87">str</span><span style="color:#000;font-weight:bold">:</span>
</span></span><span style="display:flex;"><span>    <span style="color:#204a87;font-weight:bold">return</span> <span style="color:#000">s</span><span style="color:#ce5c00;font-weight:bold">.</span><span style="color:#000">encode</span><span style="color:#000;font-weight:bold">(</span><span style="color:#4e9a06">'unicode_escape'</span><span style="color:#000;font-weight:bold">)</span><span style="color:#ce5c00;font-weight:bold">.</span><span style="color:#000">decode</span><span style="color:#000;font-weight:bold">(</span><span style="color:#4e9a06">'ascii'</span><span style="color:#000;font-weight:bold">)</span>
</span></span></code></pre></div><p>Function to <em>unescape</em> strings:</p>
<div class="highlight"><pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="nohighlight" data-noescape=""><span style="display:flex;"><span><span style="color:#204a87;font-weight:bold">def</span> <span style="color:#000">unescape</span><span style="color:#000;font-weight:bold">(</span><span style="color:#000">s</span><span style="color:#000;font-weight:bold">:</span> <span style="color:#204a87">str</span><span style="color:#000;font-weight:bold">)</span> <span style="color:#ce5c00;font-weight:bold">-&gt;</span> <span style="color:#204a87">str</span><span style="color:#000;font-weight:bold">:</span>
</span></span><span style="display:flex;"><span>    <span style="color:#204a87;font-weight:bold">return</span> <span style="color:#000">s</span><span style="color:#ce5c00;font-weight:bold">.</span><span style="color:#000">encode</span><span style="color:#000;font-weight:bold">(</span><span style="color:#4e9a06">'ascii'</span><span style="color:#000;font-weight:bold">)</span><span style="color:#ce5c00;font-weight:bold">.</span><span style="color:#000">decode</span><span style="color:#000;font-weight:bold">(</span><span style="color:#4e9a06">'unicode_escape'</span><span style="color:#000;font-weight:bold">)</span>
</span></span></code></pre></div><p>Usage example:</p>
<div class="highlight"><pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="nohighlight" data-noescape=""><span style="display:flex;"><span><span style="color:#000">s</span> <span style="color:#ce5c00;font-weight:bold">=</span> <span style="color:#4e9a06">"""
</span></span></span><span style="display:flex;"><span><span style="color:#4e9a06">value1 \ value2
</span></span></span><span style="display:flex;"><span><span style="color:#4e9a06">value3 / value4
</span></span></span><span style="display:flex;"><span><span style="color:#4e9a06">"""</span>
</span></span><span style="display:flex;"><span><span style="color:#204a87">print</span><span style="color:#000;font-weight:bold">(</span><span style="color:#000">escape</span><span style="color:#000;font-weight:bold">(</span><span style="color:#000">s</span><span style="color:#000;font-weight:bold">))</span> <span style="color:#8f5902;font-style:italic"># \nvalue1 \\ value2\nvalue3 / value4\n</span>
</span></span><span style="display:flex;"><span><span style="color:#204a87">print</span><span style="color:#000;font-weight:bold">(</span><span style="color:#000">s</span> <span style="color:#ce5c00;font-weight:bold">==</span> <span style="color:#000">escape</span><span style="color:#000;font-weight:bold">(</span><span style="color:#000">s</span><span style="color:#000;font-weight:bold">))</span> <span style="color:#8f5902;font-style:italic"># False</span>
</span></span><span style="display:flex;"><span><span style="color:#204a87">print</span><span style="color:#000;font-weight:bold">(</span><span style="color:#000">s</span> <span style="color:#ce5c00;font-weight:bold">==</span> <span style="color:#000">unescape</span><span style="color:#000;font-weight:bold">(</span><span style="color:#000">escape</span><span style="color:#000;font-weight:bold">(</span><span style="color:#000">s</span><span style="color:#000;font-weight:bold">)))</span> <span style="color:#8f5902;font-style:italic"># True</span>
</span></span></code></pre></div></section><section>
<h2 id="data-representation-formats-json">Data representation formats: JSON</h2>
<ul>
<li>A <code>.json</code> file contains a <strong>document</strong>, i.e. a <em>characters</em> string
<ul>
<li>encoding: <em>UTF-8</em></li>
</ul>
</li>
<li>The file essentially a representation of a <em>tree-like</em> data structure…</li>
<li>… where each <em>element</em> is one of the following:
<ul>
<li><em>value</em> (e.g. <em>string</em>, <em>number</em>, <em>boolean</em>, <em>null</em>)</li>
<li><em>object</em> (i.e. dictionary) of <em>key-value</em> pairs, where <em>keys</em> are <em>strings</em>, and <em>values</em> are <em>values</em></li>
<li><em>array</em> (i.e. list) of <em>values</em></li>
</ul>
</li>
</ul>
<h3 id="example">Example:</h3>
<div class="container w-100 m-0 p-0">
    <div class="row "><div class="col " style="text-align: left;"><div class="highlight"><pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="nohighlight" data-noescape=""><span style="display:flex;"><span><span style="color:#000;font-weight:bold">{</span>
</span></span><span style="display:flex;"><span>    <span style="color:#204a87;font-weight:bold">"name"</span><span style="color:#000;font-weight:bold">:</span> <span style="color:#4e9a06">"John Doe"</span><span style="color:#000;font-weight:bold">,</span>
</span></span><span style="display:flex;"><span>    <span style="color:#204a87;font-weight:bold">"age"</span><span style="color:#000;font-weight:bold">:</span> <span style="color:#0000cf;font-weight:bold">42</span><span style="color:#000;font-weight:bold">,</span>
</span></span><span style="display:flex;"><span>    <span style="color:#204a87;font-weight:bold">"password"</span><span style="color:#000;font-weight:bold">:</span> <span style="color:#204a87;font-weight:bold">null</span><span style="color:#000;font-weight:bold">,</span>
</span></span><span style="display:flex;"><span>    <span style="color:#204a87;font-weight:bold">"is_student"</span><span style="color:#000;font-weight:bold">:</span> <span style="color:#204a87;font-weight:bold">false</span><span style="color:#000;font-weight:bold">,</span>
</span></span><span style="display:flex;"><span>    <span style="color:#204a87;font-weight:bold">"is_teacher"</span><span style="color:#000;font-weight:bold">:</span> <span style="color:#204a87;font-weight:bold">true</span><span style="color:#000;font-weight:bold">,</span>
</span></span><span style="display:flex;"><span>    <span style="color:#204a87;font-weight:bold">"stats"</span><span style="color:#000;font-weight:bold">:</span> <span style="color:#000;font-weight:bold">{</span> <span style="color:#204a87;font-weight:bold">"height"</span><span style="color:#000;font-weight:bold">:</span> <span style="color:#0000cf;font-weight:bold">1.83</span><span style="color:#000;font-weight:bold">,</span> <span style="color:#204a87;font-weight:bold">"weight"</span><span style="color:#000;font-weight:bold">:</span> <span style="color:#0000cf;font-weight:bold">82.5</span> <span style="color:#000;font-weight:bold">},</span>
</span></span><span style="display:flex;"><span>    <span style="color:#204a87;font-weight:bold">"working_hours"</span><span style="color:#000;font-weight:bold">:</span> <span style="color:#000;font-weight:bold">[{</span><span style="color:#204a87;font-weight:bold">"mon"</span><span style="color:#000;font-weight:bold">:</span> <span style="color:#0000cf;font-weight:bold">8</span><span style="color:#000;font-weight:bold">},</span> <span style="color:#000;font-weight:bold">{</span><span style="color:#204a87;font-weight:bold">"tue"</span><span style="color:#000;font-weight:bold">:</span> <span style="color:#0000cf;font-weight:bold">7</span><span style="color:#000;font-weight:bold">},</span> <span style="color:#000;font-weight:bold">{</span><span style="color:#204a87;font-weight:bold">"wed"</span><span style="color:#000;font-weight:bold">:</span> <span style="color:#0000cf;font-weight:bold">7</span><span style="color:#000;font-weight:bold">},</span> <span style="color:#000;font-weight:bold">{</span><span style="color:#204a87;font-weight:bold">"thu"</span><span style="color:#000;font-weight:bold">:</span> <span style="color:#0000cf;font-weight:bold">8</span><span style="color:#000;font-weight:bold">},</span> <span style="color:#000;font-weight:bold">{</span><span style="color:#204a87;font-weight:bold">"fri"</span><span style="color:#000;font-weight:bold">:</span> <span style="color:#0000cf;font-weight:bold">6</span><span style="color:#000;font-weight:bold">}],</span>
</span></span><span style="display:flex;"><span>    <span style="color:#204a87;font-weight:bold">"address"</span><span style="color:#000;font-weight:bold">:</span> <span style="color:#000;font-weight:bold">{</span>
</span></span><span style="display:flex;"><span>        <span style="color:#204a87;font-weight:bold">"street"</span><span style="color:#000;font-weight:bold">:</span> <span style="color:#4e9a06">"123 Main St"</span><span style="color:#000;font-weight:bold">,</span>
</span></span><span style="display:flex;"><span>        <span style="color:#204a87;font-weight:bold">"city"</span><span style="color:#000;font-weight:bold">:</span> <span style="color:#4e9a06">"Springfield"</span><span style="color:#000;font-weight:bold">,</span>
</span></span><span style="display:flex;"><span>        <span style="color:#204a87;font-weight:bold">"state"</span><span style="color:#000;font-weight:bold">:</span> <span style="color:#4e9a06">"IL"</span><span style="color:#000;font-weight:bold">,</span>
</span></span><span style="display:flex;"><span>        <span style="color:#204a87;font-weight:bold">"zip"</span><span style="color:#000;font-weight:bold">:</span> <span style="color:#4e9a06">"62701"</span>
</span></span><span style="display:flex;"><span>    <span style="color:#000;font-weight:bold">}</span>
</span></span><span style="display:flex;"><span><span style="color:#000;font-weight:bold">}</span>
</span></span></code></pre></div></div>
<div class="col " style="text-align: left;"><p><img src="http://www.plantuml.com/plantuml/svg/JP51JyCm38Nl_HMHpzL4EzWcJZjm0S5fHuIcQ76RG9TKYQCAglntugxTbfFzFLllMTa7afw-WxF5M8ZymCepmhE0DwUjU748vONBbl5ZFRUz365mNcLcOzVDr8HZeAZGKkQDx0BU149vqkYpG3ukFDjJo6WKeD6qclUgrMvT2XYMVbUldaIQ5xBdZx7jKRleUV5pXBEpF9LACG95JhcTwW7LjIOThpEDDxdUfA_bCgKyXYd51EPW7f7TeQhNuaCQAmu4vMtWPEYNvKFlSvx6OAVkPJuCMNzzlyT_fcUugRSF5Kmu5QdOerNy1_y0" alt=""></p>
</div>
</div>
</div>
</section><section>
<h2 id="json-parsing--generation-in-python">JSON parsing / generation in Python</h2>
<ul>
<li>
<p>Python comes with the <em>built-in</em> <a href="https://docs.python.org/3/library/json.html">module <code>json</code></a> to <em>parse</em> and <em>generate</em> JSON documents</p>
<ul>
<li><code>json.loads(s)</code>: parses a <em>string</em> <code>s</code> representing a JSON document into a Python <em>object</em></li>
<li><code>json.dumps(o)</code>: generates a JSON document <em>string</em> from a Python <em>object</em> <code>o</code></li>
</ul>
</li>
<li>
<p>Object to JSON conversion table</p>
<ul>
<li>JSON <em>boolean</em> $\leftrightarrow$ Python <code>bool</code></li>
<li>JSON <em>number</em> $\leftrightarrow$ Python <code>int</code> or <code>float</code></li>
<li>JSON <em>string</em> $\leftrightarrow$ Python <code>str</code></li>
<li>JSON <em>array</em> $\leftrightarrow$ Python <code>list</code></li>
<li>JSON <em>object</em> $\leftrightarrow$ Python <code>dict</code></li>
<li>JSON <em>null</em> $\leftrightarrow$ Python <code>None</code></li>
</ul>
</li>
<li>
<p>Example of JSON parsing:</p>
</li>
</ul>
<div class="highlight"><pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="nohighlight" data-noescape=""><span style="display:flex;"><span><span style="color:#000">doc</span><span style="color:#000;font-weight:bold">:</span> <span style="color:#204a87">str</span> <span style="color:#ce5c00;font-weight:bold">=</span> <span style="color:#4e9a06">'{"name": "John Doe", "age": 42, "password": null, "is_student": false, "is_teacher": true, "stats": {"height": 1.83, "weight": 82.5}, "working_hours": [{"mon": 8}, {"tue": 7}, {"wed": 7}, {"thu": 8}, {"fri": 6}], "address": {"street": "123 Main St", "city": "Springfield", "state": "IL", "zip": "62701"}}'</span>
</span></span><span style="display:flex;"><span><span style="color:#000">obj</span><span style="color:#000;font-weight:bold">:</span> <span style="color:#204a87">object</span> <span style="color:#ce5c00;font-weight:bold">=</span> <span style="color:#000">json</span><span style="color:#ce5c00;font-weight:bold">.</span><span style="color:#000">loads</span><span style="color:#000;font-weight:bold">(</span><span style="color:#000">doc</span><span style="color:#000;font-weight:bold">)</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#204a87">print</span><span style="color:#000;font-weight:bold">(</span><span style="color:#204a87">type</span><span style="color:#000;font-weight:bold">(</span><span style="color:#000">obj</span><span style="color:#000;font-weight:bold">))</span> <span style="color:#8f5902;font-style:italic"># &lt;class 'dict'&gt;</span>
</span></span><span style="display:flex;"><span><span style="color:#204a87">print</span><span style="color:#000;font-weight:bold">(</span><span style="color:#204a87">type</span><span style="color:#000;font-weight:bold">(</span><span style="color:#000">obj</span><span style="color:#000;font-weight:bold">[</span><span style="color:#4e9a06">'name'</span><span style="color:#000;font-weight:bold">]),</span> <span style="color:#000">obj</span><span style="color:#000;font-weight:bold">[</span><span style="color:#4e9a06">'name'</span><span style="color:#000;font-weight:bold">])</span> <span style="color:#8f5902;font-style:italic"># &lt;class 'str'&gt; John Doe</span>
</span></span><span style="display:flex;"><span><span style="color:#204a87">print</span><span style="color:#000;font-weight:bold">(</span><span style="color:#204a87">type</span><span style="color:#000;font-weight:bold">(</span><span style="color:#000">obj</span><span style="color:#000;font-weight:bold">[</span><span style="color:#4e9a06">'age'</span><span style="color:#000;font-weight:bold">]),</span> <span style="color:#000">obj</span><span style="color:#000;font-weight:bold">[</span><span style="color:#4e9a06">'age'</span><span style="color:#000;font-weight:bold">])</span> <span style="color:#8f5902;font-style:italic"># &lt;class 'int'&gt; 42</span>
</span></span><span style="display:flex;"><span><span style="color:#204a87">print</span><span style="color:#000;font-weight:bold">(</span><span style="color:#204a87">type</span><span style="color:#000;font-weight:bold">(</span><span style="color:#000">obj</span><span style="color:#000;font-weight:bold">[</span><span style="color:#4e9a06">'password'</span><span style="color:#000;font-weight:bold">]),</span> <span style="color:#000">obj</span><span style="color:#000;font-weight:bold">[</span><span style="color:#4e9a06">'password'</span><span style="color:#000;font-weight:bold">])</span> <span style="color:#8f5902;font-style:italic"># &lt;class 'NoneType'&gt; None</span>
</span></span><span style="display:flex;"><span><span style="color:#204a87">print</span><span style="color:#000;font-weight:bold">(</span><span style="color:#204a87">type</span><span style="color:#000;font-weight:bold">(</span><span style="color:#000">obj</span><span style="color:#000;font-weight:bold">[</span><span style="color:#4e9a06">'is_student'</span><span style="color:#000;font-weight:bold">]),</span> <span style="color:#000">obj</span><span style="color:#000;font-weight:bold">[</span><span style="color:#4e9a06">'is_student'</span><span style="color:#000;font-weight:bold">])</span> <span style="color:#8f5902;font-style:italic"># &lt;class 'bool'&gt; False</span>
</span></span><span style="display:flex;"><span><span style="color:#204a87">print</span><span style="color:#000;font-weight:bold">(</span><span style="color:#204a87">type</span><span style="color:#000;font-weight:bold">(</span><span style="color:#000">obj</span><span style="color:#000;font-weight:bold">[</span><span style="color:#4e9a06">'is_teacher'</span><span style="color:#000;font-weight:bold">]),</span> <span style="color:#000">obj</span><span style="color:#000;font-weight:bold">[</span><span style="color:#4e9a06">'is_teacher'</span><span style="color:#000;font-weight:bold">])</span> <span style="color:#8f5902;font-style:italic"># &lt;class 'bool'&gt; True</span>
</span></span><span style="display:flex;"><span><span style="color:#204a87">print</span><span style="color:#000;font-weight:bold">(</span><span style="color:#204a87">type</span><span style="color:#000;font-weight:bold">(</span><span style="color:#000">obj</span><span style="color:#000;font-weight:bold">[</span><span style="color:#4e9a06">'stats'</span><span style="color:#000;font-weight:bold">]),</span> <span style="color:#000">obj</span><span style="color:#000;font-weight:bold">[</span><span style="color:#4e9a06">'stats'</span><span style="color:#000;font-weight:bold">])</span> <span style="color:#8f5902;font-style:italic"># &lt;class 'dict'&gt; {'height': 1.83, 'weight': 82.5}</span>
</span></span><span style="display:flex;"><span><span style="color:#204a87">print</span><span style="color:#000;font-weight:bold">(</span><span style="color:#204a87">type</span><span style="color:#000;font-weight:bold">(</span><span style="color:#000">obj</span><span style="color:#000;font-weight:bold">[</span><span style="color:#4e9a06">'working_hours'</span><span style="color:#000;font-weight:bold">]),</span> <span style="color:#000">obj</span><span style="color:#000;font-weight:bold">[</span><span style="color:#4e9a06">'working_hours'</span><span style="color:#000;font-weight:bold">])</span> <span style="color:#8f5902;font-style:italic"># &lt;class 'list'&gt; [{'mon': 8}, {'tue': 7}, {'wed': 7}, {'thu': 8}, {'fri': 6}]</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#204a87">print</span><span style="color:#000;font-weight:bold">(</span><span style="color:#000">json</span><span style="color:#ce5c00;font-weight:bold">.</span><span style="color:#000">dumps</span><span style="color:#000;font-weight:bold">(</span><span style="color:#000">obj</span><span style="color:#000;font-weight:bold">)</span> <span style="color:#ce5c00;font-weight:bold">==</span> <span style="color:#000">doc</span><span style="color:#000;font-weight:bold">)</span> <span style="color:#8f5902;font-style:italic"># True</span>
</span></span></code></pre></div>
</section>
</section><section>


<section data-shortcode-section="">
<h1 id="running-example-authentication">Running Example: Authentication</h1>
<p>(Part 1)</p>
</section><section>
<h2 id="how-to-support-authentication">How to support authentication</h2>
<h3 id="assuming-a-user-database-exists">Assuming a User Database exists…</h3>
<ol>
<li>
<p>letting users <strong>create</strong> a <em>new account</em></p>
<ul>
<li>relevant data: <em>username</em>, <em>email addresses</em>, <em>full name</em>, <em>role</em>, <em>password</em>
<ul>
<li>only <em>hashed</em> password are stored in-memory, <a href="https://stytch.com/blog/what-is-password-hashing/">for security reasons</a></li>
</ul>
</li>
</ul>
</li>
<li>
<p>letting users <strong>get</strong> information about registered accounts (public information only) by <em>id</em> (i.e., either username or some email)</p>
</li>
<li>
<p>letting users <strong>test</strong> whether their <em>password</em> is correct or not</p>
</li>
</ol>
<h3 id="-an-authentication-service-can-be-implemented">… an Authentication Service can be implemented</h3>
<ol>
<li>letting users <strong>generate</strong> an <em>authentication token</em> by providing their <em>credentials</em>
<ul>
<li><strong>credentials</strong>: <em>user id</em> (username or email address) + <em>password</em></li>
<li><strong>token</strong>: a <em>document</em> generated by the server, that the client can use to <em>prove</em> its identity in <em>future</em> interactions
<ul>
<li>composed by: <em>user data</em>, <em>expiration date</em>, <em>signature</em></li>
<li>easy for the server to <em>verify</em> the signature, but <em>hard</em> for the client to <em>forge</em></li>
<li>signature $\approx$ <a href="https://en.wikipedia.org/wiki/HMAC">Hash-based Message Authentication Code (HMAC)</a></li>
</ul>
</li>
</ul>
</li>
<li>letting users <strong>test</strong> whether an <em>authentication token</em> is <em>valid</em> or not
<ul>
<li><strong>valid</strong>: the token is <em>not expired</em>, and the <em>signature</em> is <em>correct</em></li>
</ul>
</li>
</ol>
</section><section>
<h2 id="modelling-classes">Modelling (classes)</h2>
<figure id="plantuml-figure-1728378405299930021" class="plantuml" alt="" style="width: 100%;height: 60vh;max-width: 95vw;max-height: 80vh;">
<p>package “users” {
class User {
+username: str
+emails: set[str]
+full_name: str
+role: Role
+password: str
+ids: set[str]
}</p>
<pre><code>class Credentials {
    +id: str
    +password: str
}

class Token {
    +user: User
    +expiration: datetime
    +signature: str
}

enum Role {
    ADMIN
    USER
}

interface UserDatabase {
    +add_user(user: User)
    +get_user(id: str) : User
    +check_password(credentials) : bool
}

interface AuthenticationService {
    +authenticate(credentials, duration) : Token
    +validate_token(token) : bool
}

package "impl" {
    class InMemoryUserDatabase {
        +__users: dict[str, User]
        +add_user(user: User)
        +get_user(id: str) : User
        +check_password(credentials) : bool
        +__get_user(id: str) : User
    }

    class InMemoryAuthenticationService {
        +__database: UserDatabase
        +__secret: str
        +authenticate(credentials, duration) : Token
        +validate_token(token) : bool
        +__validate_token_signature(token) : bool
    }

    InMemoryAuthenticationService *-l- InMemoryUserDatabase
}

UserDatabase &lt;|.. InMemoryUserDatabase
AuthenticationService &lt;|.. InMemoryAuthenticationService
</code></pre>
<p>}</p>
</figure>
<script>
    handlePlantumlFigureByID("plantuml-figure-1728378405299930021");
</script>
<div class="container w-100 m-0 p-0">
    <div class="row "><div class="col " style="text-align: left;"><ul>
<li>Data classes in <a href="https://github.com/unibo-fc-isi-ds/lab-snippets/blob/master/snippets/lab4/users/__init__.py"><code>snippets.lab4.users</code></a>:
<ul>
<li><code>User</code>: represents an account</li>
<li><code>Credentials</code>: an id—password pair</li>
<li><code>Token</code>: represents an authentication token</li>
<li><code>Role</code>: enumeration with admissible roles</li>
</ul>
</li>
</ul>
</div>
<div class="col " style="text-align: left;"><ul>
<li>Interfaces in <a href="https://github.com/unibo-fc-isi-ds/lab-snippets/blob/master/snippets/lab4/users/__init__.py"><code>snippets.lab4.users</code></a>:
<ul>
<li><code>UserDatabase</code>: interface for a user database</li>
<li><code>AuthenticationService</code>: interface for an authentication service</li>
</ul>
</li>
<li>Implementation classes in <a href="https://github.com/unibo-fc-isi-ds/lab-snippets/blob/master/snippets/lab4/users/impl.py"><code>snippets.lab4.users.impl</code></a>:
<ul>
<li><code>InMemoryUserDatabase</code>: default implementation of user DB</li>
<li><code>InMemoryAuthenticationService</code>: default implementation of authentication service</li>
</ul>
</li>
</ul>
</div>
</div>
</div>
</section><section>
<h2 id="modelling-interaction">Modelling (interaction)</h2>
<p><img src="https://www.plantuml.com/plantuml/svg/jLNRQXin47tNLynJyMBN7s3OaE8QMkW5ahHzQCeoMKrjaLt9wEAcVr-j54-sD5uKaZxPp4XdvfmvEpft7gqFVITsIXByDCRVc3iXiFN6mXT7LWY97c_G4RpN7watzlSGVdiV5FjuNxLgZzhpWJV1xqZ7C7fbz2NPWsf9YBg6jQKOqzi43NKjHFhp-knHy1MWb4s8aLceXfxK0Vs9FXuBdiPj4ghx7fR3hyQUVa0D0QxrjHybgKVLvSp90aaaIPFT9UuNXF89rBVaCtKbNvPxIFMFB9UnJYennMy5bdom6a8fsVMEsjl8TfYu7Bo0dIiWtGxNcZqwzyjOEMij_NVogSYI5IX6KguvOATaH7it6z2MnxQh2keOJC0SB1EOKOj4_c2sIiFiojoIll-qZ1wA2zPv-fjS0Jw4AJRCirg033RZiVxJM68oMppoKG_FcFm4vQShZPtdqvCi2whpSacEKJ8jb_WtRnwwswkiUWn_-lmDvZo6VC2fhSROFh7hO3w-DOVBpVfYSrLDzlclxPA54jvY1BTug5S9wXo1DkLIS0bKyUPNx09jh3LMa1wBNl1g_9LXmqT49TdonOu_v6lK-CJPluo_2mgF5ePFpmw_FQ3qqHTvpA_YYT5Kpv8NECD3oMicWy4yPfxl1EwoV4Bdf6Nekpy0" alt=""></p>
<p>(open in another tab to zoom in)</p>
</section><section>
<h2 id="exemplify-implementation">Exemplify implementation</h2>
<p>(cf. <a href="https://github.com/unibo-fc-isi-ds/lab-snippets/blob/master/snippets/lab4/example0_users.py">https://github.com/unibo-fc-isi-ds/lab-snippets/blob/master/snippets/lab4/example0_users.py</a>)</p>
<div class="highlight"><pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="nohighlight" data-noescape=""><span style="display:flex;"><span><span style="color:#204a87;font-weight:bold">from</span> <span style="color:#000">.users</span> <span style="color:#204a87;font-weight:bold">import</span> <span style="color:#ce5c00;font-weight:bold">*</span>
</span></span><span style="display:flex;"><span><span style="color:#204a87;font-weight:bold">from</span> <span style="color:#000">.users.impl</span> <span style="color:#204a87;font-weight:bold">import</span> <span style="color:#ce5c00;font-weight:bold">*</span>
</span></span><span style="display:flex;"><span><span style="color:#204a87;font-weight:bold">import</span> <span style="color:#000">time</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#000">user_db</span> <span style="color:#ce5c00;font-weight:bold">=</span> <span style="color:#000">InMemoryUserDatabase</span><span style="color:#000;font-weight:bold">()</span>
</span></span><span style="display:flex;"><span><span style="color:#000">auth_service</span> <span style="color:#ce5c00;font-weight:bold">=</span> <span style="color:#000">InMemoryAuthenticationService</span><span style="color:#000;font-weight:bold">(</span><span style="color:#000">user_db</span><span style="color:#000;font-weight:bold">)</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#000">gc_user</span> <span style="color:#ce5c00;font-weight:bold">=</span> <span style="color:#000">User</span><span style="color:#000;font-weight:bold">(</span>
</span></span><span style="display:flex;"><span>    <span style="color:#000">username</span><span style="color:#ce5c00;font-weight:bold">=</span><span style="color:#4e9a06">'gciatto'</span><span style="color:#000;font-weight:bold">,</span>
</span></span><span style="display:flex;"><span>    <span style="color:#000">emails</span><span style="color:#ce5c00;font-weight:bold">=</span><span style="color:#000;font-weight:bold">{</span><span style="color:#4e9a06">'giovanni.ciatto@unibo.it'</span><span style="color:#000;font-weight:bold">,</span> <span style="color:#4e9a06">'giovanni.ciatto@gmail.com'</span><span style="color:#000;font-weight:bold">},</span>
</span></span><span style="display:flex;"><span>    <span style="color:#000">full_name</span><span style="color:#ce5c00;font-weight:bold">=</span><span style="color:#4e9a06">'Giovanni Ciatto'</span><span style="color:#000;font-weight:bold">,</span>
</span></span><span style="display:flex;"><span>    <span style="color:#000">role</span><span style="color:#ce5c00;font-weight:bold">=</span><span style="color:#000">Role</span><span style="color:#ce5c00;font-weight:bold">.</span><span style="color:#000">ADMIN</span><span style="color:#000;font-weight:bold">,</span>
</span></span><span style="display:flex;"><span>    <span style="color:#000">password</span><span style="color:#ce5c00;font-weight:bold">=</span><span style="color:#4e9a06">'my secret password'</span><span style="color:#000;font-weight:bold">,</span>
</span></span><span style="display:flex;"><span><span style="color:#000;font-weight:bold">)</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#000">gc_user_hidden_password</span> <span style="color:#ce5c00;font-weight:bold">=</span> <span style="color:#000">gc_user</span><span style="color:#ce5c00;font-weight:bold">.</span><span style="color:#000">copy</span><span style="color:#000;font-weight:bold">(</span><span style="color:#000">password</span><span style="color:#ce5c00;font-weight:bold">=</span><span style="color:#204a87;font-weight:bold">None</span><span style="color:#000;font-weight:bold">)</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#000">gc_credentials_ok</span> <span style="color:#ce5c00;font-weight:bold">=</span> <span style="color:#000;font-weight:bold">[</span><span style="color:#000">Credentials</span><span style="color:#000;font-weight:bold">(</span><span style="color:#204a87">id</span><span style="color:#000;font-weight:bold">,</span> <span style="color:#000">gc_user</span><span style="color:#ce5c00;font-weight:bold">.</span><span style="color:#000">password</span><span style="color:#000;font-weight:bold">)</span> <span style="color:#204a87;font-weight:bold">for</span> <span style="color:#204a87">id</span> <span style="color:#204a87;font-weight:bold">in</span> <span style="color:#000">gc_user</span><span style="color:#ce5c00;font-weight:bold">.</span><span style="color:#000">ids</span><span style="color:#000;font-weight:bold">]</span> <span style="color:#8f5902;font-style:italic"># type: ignore</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#000">gc_credentials_wrong</span> <span style="color:#ce5c00;font-weight:bold">=</span> <span style="color:#000">Credentials</span><span style="color:#000;font-weight:bold">(</span>
</span></span><span style="display:flex;"><span>    <span style="color:#204a87">id</span><span style="color:#ce5c00;font-weight:bold">=</span><span style="color:#4e9a06">'giovanni.ciatto@unibo.it'</span><span style="color:#000;font-weight:bold">,</span>
</span></span><span style="display:flex;"><span>    <span style="color:#000">password</span><span style="color:#ce5c00;font-weight:bold">=</span><span style="color:#4e9a06">'wrong password'</span><span style="color:#000;font-weight:bold">,</span>
</span></span><span style="display:flex;"><span><span style="color:#000;font-weight:bold">)</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#8f5902;font-style:italic"># Trying to get a user that does not exist should raise a KeyError</span>
</span></span><span style="display:flex;"><span><span style="color:#204a87;font-weight:bold">try</span><span style="color:#000;font-weight:bold">:</span>
</span></span><span style="display:flex;"><span>    <span style="color:#000">user_db</span><span style="color:#ce5c00;font-weight:bold">.</span><span style="color:#000">get_user</span><span style="color:#000;font-weight:bold">(</span><span style="color:#4e9a06">'gciatto'</span><span style="color:#000;font-weight:bold">)</span>
</span></span><span style="display:flex;"><span><span style="color:#204a87;font-weight:bold">except</span> <span style="color:#c00;font-weight:bold">KeyError</span> <span style="color:#204a87;font-weight:bold">as</span> <span style="color:#000">e</span><span style="color:#000;font-weight:bold">:</span>
</span></span><span style="display:flex;"><span>    <span style="color:#204a87;font-weight:bold">assert</span> <span style="color:#4e9a06">'User with ID gciatto not found'</span> <span style="color:#204a87;font-weight:bold">in</span> <span style="color:#204a87">str</span><span style="color:#000;font-weight:bold">(</span><span style="color:#000">e</span><span style="color:#000;font-weight:bold">)</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#8f5902;font-style:italic"># Adding a novel user should work</span>
</span></span><span style="display:flex;"><span><span style="color:#000">user_db</span><span style="color:#ce5c00;font-weight:bold">.</span><span style="color:#000">add_user</span><span style="color:#000;font-weight:bold">(</span><span style="color:#000">gc_user</span><span style="color:#000;font-weight:bold">)</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#8f5902;font-style:italic"># Trying to add a user that already exist should raise a ValueError</span>
</span></span><span style="display:flex;"><span><span style="color:#204a87;font-weight:bold">try</span><span style="color:#000;font-weight:bold">:</span>
</span></span><span style="display:flex;"><span>    <span style="color:#000">user_db</span><span style="color:#ce5c00;font-weight:bold">.</span><span style="color:#000">add_user</span><span style="color:#000;font-weight:bold">(</span><span style="color:#000">gc_user</span><span style="color:#000;font-weight:bold">)</span>
</span></span><span style="display:flex;"><span><span style="color:#204a87;font-weight:bold">except</span> <span style="color:#c00;font-weight:bold">ValueError</span> <span style="color:#204a87;font-weight:bold">as</span> <span style="color:#000">e</span><span style="color:#000;font-weight:bold">:</span>
</span></span><span style="display:flex;"><span>    <span style="color:#204a87;font-weight:bold">assert</span> <span style="color:#204a87">str</span><span style="color:#000;font-weight:bold">(</span><span style="color:#000">e</span><span style="color:#000;font-weight:bold">)</span><span style="color:#ce5c00;font-weight:bold">.</span><span style="color:#000">startswith</span><span style="color:#000;font-weight:bold">(</span><span style="color:#4e9a06">'User with ID'</span><span style="color:#000;font-weight:bold">)</span>
</span></span><span style="display:flex;"><span>    <span style="color:#204a87;font-weight:bold">assert</span> <span style="color:#204a87">str</span><span style="color:#000;font-weight:bold">(</span><span style="color:#000">e</span><span style="color:#000;font-weight:bold">)</span><span style="color:#ce5c00;font-weight:bold">.</span><span style="color:#000">endswith</span><span style="color:#000;font-weight:bold">(</span><span style="color:#4e9a06">'already exists'</span><span style="color:#000;font-weight:bold">)</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#8f5902;font-style:italic"># Getting a user that exists should work</span>
</span></span><span style="display:flex;"><span><span style="color:#204a87;font-weight:bold">assert</span> <span style="color:#000">user_db</span><span style="color:#ce5c00;font-weight:bold">.</span><span style="color:#000">get_user</span><span style="color:#000;font-weight:bold">(</span><span style="color:#4e9a06">'gciatto'</span><span style="color:#000;font-weight:bold">)</span> <span style="color:#ce5c00;font-weight:bold">==</span> <span style="color:#000">gc_user</span><span style="color:#ce5c00;font-weight:bold">.</span><span style="color:#000">copy</span><span style="color:#000;font-weight:bold">(</span><span style="color:#000">password</span><span style="color:#ce5c00;font-weight:bold">=</span><span style="color:#204a87;font-weight:bold">None</span><span style="color:#000;font-weight:bold">)</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#8f5902;font-style:italic"># Checking credentials should work if there exists a user with the same ID and password (no matter which ID is used)</span>
</span></span><span style="display:flex;"><span><span style="color:#204a87;font-weight:bold">for</span> <span style="color:#000">gc_cred</span> <span style="color:#204a87;font-weight:bold">in</span> <span style="color:#000">gc_credentials_ok</span><span style="color:#000;font-weight:bold">:</span>
</span></span><span style="display:flex;"><span>    <span style="color:#204a87;font-weight:bold">assert</span> <span style="color:#000">user_db</span><span style="color:#ce5c00;font-weight:bold">.</span><span style="color:#000">check_password</span><span style="color:#000;font-weight:bold">(</span><span style="color:#000">gc_cred</span><span style="color:#000;font-weight:bold">)</span> <span style="color:#ce5c00;font-weight:bold">==</span> <span style="color:#204a87;font-weight:bold">True</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#8f5902;font-style:italic"># Checking credentials should fail if the password is wrong</span>
</span></span><span style="display:flex;"><span><span style="color:#204a87;font-weight:bold">assert</span> <span style="color:#000">user_db</span><span style="color:#ce5c00;font-weight:bold">.</span><span style="color:#000">check_password</span><span style="color:#000;font-weight:bold">(</span><span style="color:#000">gc_credentials_wrong</span><span style="color:#000;font-weight:bold">)</span> <span style="color:#ce5c00;font-weight:bold">==</span> <span style="color:#204a87;font-weight:bold">False</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#8f5902;font-style:italic"># Authenticating with wrong credentials should raise a ValueError</span>
</span></span><span style="display:flex;"><span><span style="color:#204a87;font-weight:bold">try</span><span style="color:#000;font-weight:bold">:</span>
</span></span><span style="display:flex;"><span>    <span style="color:#000">auth_service</span><span style="color:#ce5c00;font-weight:bold">.</span><span style="color:#000">authenticate</span><span style="color:#000;font-weight:bold">(</span><span style="color:#000">gc_credentials_wrong</span><span style="color:#000;font-weight:bold">)</span>
</span></span><span style="display:flex;"><span><span style="color:#204a87;font-weight:bold">except</span> <span style="color:#c00;font-weight:bold">ValueError</span> <span style="color:#204a87;font-weight:bold">as</span> <span style="color:#000">e</span><span style="color:#000;font-weight:bold">:</span>
</span></span><span style="display:flex;"><span>    <span style="color:#204a87;font-weight:bold">assert</span> <span style="color:#4e9a06">'Invalid credentials'</span> <span style="color:#204a87;font-weight:bold">in</span> <span style="color:#204a87">str</span><span style="color:#000;font-weight:bold">(</span><span style="color:#000">e</span><span style="color:#000;font-weight:bold">)</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#8f5902;font-style:italic"># Authenticating with correct credentials should work</span>
</span></span><span style="display:flex;"><span><span style="color:#000">gc_token</span> <span style="color:#ce5c00;font-weight:bold">=</span> <span style="color:#000">auth_service</span><span style="color:#ce5c00;font-weight:bold">.</span><span style="color:#000">authenticate</span><span style="color:#000;font-weight:bold">(</span><span style="color:#000">gc_credentials_ok</span><span style="color:#000;font-weight:bold">[</span><span style="color:#0000cf;font-weight:bold">0</span><span style="color:#000;font-weight:bold">])</span>
</span></span><span style="display:flex;"><span><span style="color:#8f5902;font-style:italic"># The token should contain the user, but not the password</span>
</span></span><span style="display:flex;"><span><span style="color:#204a87;font-weight:bold">assert</span> <span style="color:#000">gc_token</span><span style="color:#ce5c00;font-weight:bold">.</span><span style="color:#000">user</span> <span style="color:#ce5c00;font-weight:bold">==</span> <span style="color:#000">gc_user_hidden_password</span>
</span></span><span style="display:flex;"><span><span style="color:#8f5902;font-style:italic"># The token should expire in the future</span>
</span></span><span style="display:flex;"><span><span style="color:#204a87;font-weight:bold">assert</span> <span style="color:#000">gc_token</span><span style="color:#ce5c00;font-weight:bold">.</span><span style="color:#000">expiration</span> <span style="color:#ce5c00;font-weight:bold">&gt;</span> <span style="color:#000">datetime</span><span style="color:#ce5c00;font-weight:bold">.</span><span style="color:#000">now</span><span style="color:#000;font-weight:bold">()</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#8f5902;font-style:italic"># A genuine, unexpired token should be valid</span>
</span></span><span style="display:flex;"><span><span style="color:#204a87;font-weight:bold">assert</span> <span style="color:#000">auth_service</span><span style="color:#ce5c00;font-weight:bold">.</span><span style="color:#000">validate_token</span><span style="color:#000;font-weight:bold">(</span><span style="color:#000">gc_token</span><span style="color:#000;font-weight:bold">)</span> <span style="color:#ce5c00;font-weight:bold">==</span> <span style="color:#204a87;font-weight:bold">True</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#8f5902;font-style:italic"># A token with wrong signature should be invalid</span>
</span></span><span style="display:flex;"><span><span style="color:#000">gc_token_wrong_signature</span> <span style="color:#ce5c00;font-weight:bold">=</span> <span style="color:#000">gc_token</span><span style="color:#ce5c00;font-weight:bold">.</span><span style="color:#000">copy</span><span style="color:#000;font-weight:bold">(</span><span style="color:#000">signature</span><span style="color:#ce5c00;font-weight:bold">=</span><span style="color:#4e9a06">'wrong signature'</span><span style="color:#000;font-weight:bold">)</span>
</span></span><span style="display:flex;"><span><span style="color:#204a87;font-weight:bold">assert</span> <span style="color:#000">auth_service</span><span style="color:#ce5c00;font-weight:bold">.</span><span style="color:#000">validate_token</span><span style="color:#000;font-weight:bold">(</span><span style="color:#000">gc_token_wrong_signature</span><span style="color:#000;font-weight:bold">)</span> <span style="color:#ce5c00;font-weight:bold">==</span> <span style="color:#204a87;font-weight:bold">False</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#8f5902;font-style:italic"># A token with expiration in the past should be invalid</span>
</span></span><span style="display:flex;"><span><span style="color:#000">gc_token_expired</span> <span style="color:#ce5c00;font-weight:bold">=</span> <span style="color:#000">auth_service</span><span style="color:#ce5c00;font-weight:bold">.</span><span style="color:#000">authenticate</span><span style="color:#000;font-weight:bold">(</span><span style="color:#000">gc_credentials_ok</span><span style="color:#000;font-weight:bold">[</span><span style="color:#0000cf;font-weight:bold">0</span><span style="color:#000;font-weight:bold">],</span> <span style="color:#000">timedelta</span><span style="color:#000;font-weight:bold">(</span><span style="color:#000">milliseconds</span><span style="color:#ce5c00;font-weight:bold">=</span><span style="color:#0000cf;font-weight:bold">10</span><span style="color:#000;font-weight:bold">))</span>
</span></span><span style="display:flex;"><span><span style="color:#000">time</span><span style="color:#ce5c00;font-weight:bold">.</span><span style="color:#000">sleep</span><span style="color:#000;font-weight:bold">(</span><span style="color:#0000cf;font-weight:bold">0.1</span><span style="color:#000;font-weight:bold">)</span>
</span></span><span style="display:flex;"><span><span style="color:#204a87;font-weight:bold">assert</span> <span style="color:#000">auth_service</span><span style="color:#ce5c00;font-weight:bold">.</span><span style="color:#000">validate_token</span><span style="color:#000;font-weight:bold">(</span><span style="color:#000">gc_token_expired</span><span style="color:#000;font-weight:bold">)</span> <span style="color:#ce5c00;font-weight:bold">==</span> <span style="color:#204a87;font-weight:bold">False</span>
</span></span></code></pre></div><ul>
<li>run with <code>python -m snippets -l 4 -e 0</code>
<ul>
<li>analyse the logs to understand what’s going on</li>
</ul>
</li>
</ul>
</section><section>
<h2 id="whats-next">What’s next?</h2>
<p>In the remainder of this lecture, we will focus on making the <em>user database</em> and <em>authentication service</em> <strong>distributed</strong>:</p>
<ol>
<li>clients will be able to <em>register</em> and <em>authenticate</em> themselves <em>remotely</em>, via <strong>RPC</strong></li>
<li>we will use <strong>JSON</strong> as the <em>data interchange format</em> for <em>RPC</em> and <em>(de)serialization</em></li>
<li>notice that many different sorts of <em>data</em> may be exchanged between <em>clients</em> and <em>servers</em>
<ul>
<li>e.g. <em>user data</em>, <em>credentials</em>, <em>authentication tokens</em>, etc.,</li>
<li>but also, indirectly: <em>strings</em>, <em>dates</em>, <em>roles</em>, etc.</li>
<li>potentially, also <em>error messages</em>?</li>
</ul>
</li>
<li>let’s proceed step by step</li>
</ol>

</section>
</section><section>


<section data-shortcode-section="">
<h2 id="deserialization">(De)Serialization</h2>
<ul>
<li><strong>Serialization</strong> $\equiv$ converting <em>in-memory</em> <strong>objects</strong> into <strong>char</strong>/<em>byte</em> <strong>sequences</strong>, according to some <em>data interchange format</em></li>
<li><strong>Deserialization</strong> $\equiv$ converting <strong>char</strong>/<em>byte</em> <strong>sequences</strong> back into <em>in-memory</em> <strong>objects</strong>, according to the <em>same</em> data interchange format</li>
</ul>
<div class="container w-100 m-0 p-0">
    <div class="row "><div class="col col-5" style="text-align: left;"><div class="highlight"><pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="nohighlight" data-noescape=""><span style="display:flex;"><span><span style="color:#204a87;font-weight:bold">from</span> <span style="color:#000">snippets.lab4.users</span> <span style="color:#204a87;font-weight:bold">import</span> <span style="color:#000">User</span><span style="color:#000;font-weight:bold">,</span> <span style="color:#000">Role</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#000">User</span><span style="color:#000;font-weight:bold">(</span>
</span></span><span style="display:flex;"><span>    <span style="color:#000">username</span><span style="color:#ce5c00;font-weight:bold">=</span><span style="color:#4e9a06">'gciatto'</span><span style="color:#000;font-weight:bold">,</span>
</span></span><span style="display:flex;"><span>    <span style="color:#000">emails</span><span style="color:#ce5c00;font-weight:bold">=</span><span style="color:#000;font-weight:bold">{</span>
</span></span><span style="display:flex;"><span>        <span style="color:#4e9a06">'giovanni.ciatto@unibo.it'</span><span style="color:#000;font-weight:bold">,</span>
</span></span><span style="display:flex;"><span>        <span style="color:#4e9a06">'giovanni.ciatto@gmail.com'</span>
</span></span><span style="display:flex;"><span>    <span style="color:#000;font-weight:bold">},</span>
</span></span><span style="display:flex;"><span>    <span style="color:#000">full_name</span><span style="color:#ce5c00;font-weight:bold">=</span><span style="color:#4e9a06">'Giovanni Ciatto'</span><span style="color:#000;font-weight:bold">,</span>
</span></span><span style="display:flex;"><span>    <span style="color:#000">role</span><span style="color:#ce5c00;font-weight:bold">=</span><span style="color:#000">Role</span><span style="color:#ce5c00;font-weight:bold">.</span><span style="color:#000">ADMIN</span><span style="color:#000;font-weight:bold">,</span>
</span></span><span style="display:flex;"><span>    <span style="color:#000">password</span><span style="color:#ce5c00;font-weight:bold">=</span><span style="color:#4e9a06">'my secret password'</span><span style="color:#000;font-weight:bold">,</span>
</span></span><span style="display:flex;"><span><span style="color:#000;font-weight:bold">)</span>
</span></span></code></pre></div></div>
<div class="col col-2" style="text-align: left;"><p>$\xrightarrow{\text{serialization}}$</p>
<p>$\xleftarrow{\text{deserialization}}$</p>
</div>
<div class="col col-5" style="text-align: left;"><div class="highlight"><pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="nohighlight" data-noescape=""><span style="display:flex;"><span><span style="color:#000;font-weight:bold">{</span>
</span></span><span style="display:flex;"><span>    <span style="color:#204a87;font-weight:bold">"username"</span><span style="color:#000;font-weight:bold">:</span> <span style="color:#4e9a06">"gciatto"</span><span style="color:#000;font-weight:bold">,</span>
</span></span><span style="display:flex;"><span>    <span style="color:#204a87;font-weight:bold">"emails"</span><span style="color:#000;font-weight:bold">:</span> <span style="color:#000;font-weight:bold">[</span>
</span></span><span style="display:flex;"><span>        <span style="color:#4e9a06">"giovanni.ciatto@unibo.it"</span><span style="color:#000;font-weight:bold">,</span>
</span></span><span style="display:flex;"><span>        <span style="color:#4e9a06">"giovanni.ciatto@gmail.com"</span>
</span></span><span style="display:flex;"><span>    <span style="color:#000;font-weight:bold">],</span>
</span></span><span style="display:flex;"><span>    <span style="color:#204a87;font-weight:bold">"full_name"</span><span style="color:#000;font-weight:bold">:</span> <span style="color:#4e9a06">"Giovanni Ciatto"</span><span style="color:#000;font-weight:bold">,</span>
</span></span><span style="display:flex;"><span>    <span style="color:#204a87;font-weight:bold">"role"</span><span style="color:#000;font-weight:bold">:</span> <span style="color:#000;font-weight:bold">{</span><span style="color:#204a87;font-weight:bold">"name"</span><span style="color:#000;font-weight:bold">:</span> <span style="color:#4e9a06">"ADMIN"</span><span style="color:#000;font-weight:bold">},</span>
</span></span><span style="display:flex;"><span>    <span style="color:#204a87;font-weight:bold">"password"</span><span style="color:#000;font-weight:bold">:</span> <span style="color:#4e9a06">"my secret password"</span><span style="color:#000;font-weight:bold">,</span>
</span></span><span style="display:flex;"><span><span style="color:#000;font-weight:bold">}</span>
</span></span></code></pre></div></div>
</div>
</div>
<ul>
<li>
<p>One key part in any distributed system <em>design</em> / implementation is how to about <em>supporting</em> (de)serialization:</p>
<ul>
<li><em>what</em> data should be (de)serialized?</li>
<li>how exactly should it be (de)serialized?
<ul>
<li>which <em>data interchange format</em> should be used?</li>
<li>which <em>fields</em> should be serialized? which ones could be <em>omitted</em>?</li>
<li>how to deal with <em>circular references</em>?</li>
</ul>
</li>
</ul>
</li>
<li>
<p>Engineers will commonly design/implement <strong>(de)serializers</strong>:</p>
<ul>
<li>i.e. <em>objects</em> aimed at <em>performing</em> (de)serialization…</li>
<li>… for <em>all</em> relevant <em>data types</em> in the system
<ul>
<li>and the other <em>data types</em> they depend on</li>
<li>there including relevant <em>built-in</em> types from the <em>programming language</em> used (e.g. <code>datetime</code>, <code>set</code>, etc.)</li>
</ul>
</li>
</ul>
</li>
</ul>
</section><section>
<h2 id="deserialization-in-practice">(De)Serialization in Practice</h2>
<ul>
<li>
<p><em>Serialisation</em> usually involves the construction of an <strong>Abstract Syntax Tree</strong> (AST) from the <em>in-memory</em> object</p>
<ul>
<li>the AST is then <em>converted</em> into a <em>char</em>/<em>byte</em> sequence</li>
</ul>
</li>
<li>
<p><em>Deserialisation</em> usually involves the <em>opposite</em> process:</p>
<ul>
<li>the <em>char</em>/<em>byte</em> sequence is then <em>converted back</em> into an AST</li>
<li>the AST is then <em>converted back</em> into an <em>in-memory</em> object</li>
</ul>
</li>
</ul>
<div class="container w-100 m-0 p-0">
    <div class="row "><div class="col col-4" style="text-align: left;"><div class="highlight"><pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="nohighlight" data-noescape=""><span style="display:flex;"><span><span style="color:#8f5902;font-style:italic"># Python object</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#000">User</span><span style="color:#000;font-weight:bold">(</span>
</span></span><span style="display:flex;"><span>  <span style="color:#000">username</span><span style="color:#ce5c00;font-weight:bold">=</span><span style="color:#4e9a06">'gciatto'</span><span style="color:#000;font-weight:bold">,</span>
</span></span><span style="display:flex;"><span>  <span style="color:#000">emails</span><span style="color:#ce5c00;font-weight:bold">=</span><span style="color:#000;font-weight:bold">{</span>
</span></span><span style="display:flex;"><span>    <span style="color:#4e9a06">'giovanni.ciatto@unibo.it'</span><span style="color:#000;font-weight:bold">,</span>
</span></span><span style="display:flex;"><span>    <span style="color:#4e9a06">'giovanni.ciatto@gmail.com'</span>
</span></span><span style="display:flex;"><span>  <span style="color:#000;font-weight:bold">},</span>
</span></span><span style="display:flex;"><span>  <span style="color:#000">full_name</span><span style="color:#ce5c00;font-weight:bold">=</span><span style="color:#4e9a06">'Giovanni Ciatto'</span><span style="color:#000;font-weight:bold">,</span>
</span></span><span style="display:flex;"><span>  <span style="color:#000">role</span><span style="color:#ce5c00;font-weight:bold">=</span><span style="color:#000">Role</span><span style="color:#ce5c00;font-weight:bold">.</span><span style="color:#000">ADMIN</span><span style="color:#000;font-weight:bold">,</span>
</span></span><span style="display:flex;"><span>  <span style="color:#000">password</span><span style="color:#ce5c00;font-weight:bold">=</span><span style="color:#4e9a06">'my secret password'</span><span style="color:#000;font-weight:bold">,</span>
</span></span><span style="display:flex;"><span><span style="color:#000;font-weight:bold">)</span>
</span></span></code></pre></div></div>
<div class="col col-4" style="text-align: left;"><div class="highlight"><pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="nohighlight" data-noescape=""><span style="display:flex;"><span><span style="color:#8f5902;font-style:italic">#&nbsp;Python dict (AST)</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#204a87">dict</span><span style="color:#000;font-weight:bold">(</span>
</span></span><span style="display:flex;"><span>  <span style="color:#000">username</span><span style="color:#ce5c00;font-weight:bold">=</span><span style="color:#4e9a06">'gciatto'</span><span style="color:#000;font-weight:bold">,</span>
</span></span><span style="display:flex;"><span>  <span style="color:#000">emails</span><span style="color:#ce5c00;font-weight:bold">=</span><span style="color:#000;font-weight:bold">[</span>
</span></span><span style="display:flex;"><span>    <span style="color:#4e9a06">'giovanni.ciatto@unibo.it'</span><span style="color:#000;font-weight:bold">,</span>
</span></span><span style="display:flex;"><span>    <span style="color:#4e9a06">'giovanni.ciatto@gmail.com'</span><span style="color:#000;font-weight:bold">,</span>
</span></span><span style="display:flex;"><span>  <span style="color:#000;font-weight:bold">],</span>
</span></span><span style="display:flex;"><span>  <span style="color:#000">full_name</span><span style="color:#ce5c00;font-weight:bold">=</span><span style="color:#4e9a06">'Giovanni Ciatto'</span><span style="color:#000;font-weight:bold">,</span>
</span></span><span style="display:flex;"><span>  <span style="color:#000">role</span><span style="color:#ce5c00;font-weight:bold">=</span><span style="color:#204a87">dict</span><span style="color:#000;font-weight:bold">(</span><span style="color:#000">name</span><span style="color:#ce5c00;font-weight:bold">=</span><span style="color:#4e9a06">'ADMIN'</span><span style="color:#000;font-weight:bold">),</span>
</span></span><span style="display:flex;"><span>  <span style="color:#000">password</span><span style="color:#ce5c00;font-weight:bold">=</span><span style="color:#4e9a06">'my secret password'</span><span style="color:#000;font-weight:bold">,</span>
</span></span><span style="display:flex;"><span><span style="color:#000;font-weight:bold">)</span>
</span></span></code></pre></div></div>
<div class="col col-4" style="text-align: left;"><div class="highlight"><pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="nohighlight" data-noescape=""><span style="display:flex;"><span><span style="color:#8f5902;font-style:italic">// JSON document
</span></span></span><span style="display:flex;"><span><span style="color:#8f5902;font-style:italic"></span>
</span></span><span style="display:flex;"><span><span style="color:#000;font-weight:bold">{</span>
</span></span><span style="display:flex;"><span>  <span style="color:#204a87;font-weight:bold">"username"</span><span style="color:#000;font-weight:bold">:</span> <span style="color:#4e9a06">"gciatto"</span><span style="color:#000;font-weight:bold">,</span>
</span></span><span style="display:flex;"><span>  <span style="color:#204a87;font-weight:bold">"emails"</span><span style="color:#000;font-weight:bold">:</span> <span style="color:#000;font-weight:bold">[</span>
</span></span><span style="display:flex;"><span>    <span style="color:#4e9a06">"giovanni.ciatto@unibo.it"</span><span style="color:#000;font-weight:bold">,</span>
</span></span><span style="display:flex;"><span>    <span style="color:#4e9a06">"giovanni.ciatto@gmail.com"</span>
</span></span><span style="display:flex;"><span>  <span style="color:#000;font-weight:bold">],</span>
</span></span><span style="display:flex;"><span>  <span style="color:#204a87;font-weight:bold">"full_name"</span><span style="color:#000;font-weight:bold">:</span> <span style="color:#4e9a06">"Giovanni Ciatto"</span><span style="color:#000;font-weight:bold">,</span>
</span></span><span style="display:flex;"><span>  <span style="color:#204a87;font-weight:bold">"role"</span><span style="color:#000;font-weight:bold">:</span> <span style="color:#000;font-weight:bold">{</span><span style="color:#204a87;font-weight:bold">"name"</span><span style="color:#000;font-weight:bold">:</span> <span style="color:#4e9a06">"ADMIN"</span><span style="color:#000;font-weight:bold">},</span>
</span></span><span style="display:flex;"><span>  <span style="color:#204a87;font-weight:bold">"password"</span><span style="color:#000;font-weight:bold">:</span> <span style="color:#4e9a06">"my secret password"</span><span style="color:#000;font-weight:bold">,</span>
</span></span><span style="display:flex;"><span><span style="color:#000;font-weight:bold">}</span>
</span></span></code></pre></div></div>
</div>
</div>
<ul>
<li>Many (de)serialization <em>libraries</em> exist for most common programming languages and data interchange formats
<ul>
<li>e.g. in Python: <a href="https://docs.python.org/3/library/json.html"><code>json</code></a>, <a href="https://docs.python.org/3/library/pickle.html"><code>pickle</code></a>, <a href="https://marshmallow.readthedocs.io/en/stable/"><code>marshmallow</code></a>, <a href="https://pypi.org/project/PyYAML/"><code>PyYaml</code></a>, etc.</li>
</ul>
</li>
<li>They commonly provide for free:
<ul>
<li>serialization of AST into <em>char</em>/<em>byte</em> sequences</li>
<li>deserialization of <em>char</em>/<em>byte</em> sequences into AST</li>
<li>sometimes, AST $\leftrightarrow$ built-in data type conversions</li>
</ul>
</li>
<li>Users <strong>must</strong> <em>define</em> AST $\leftrightarrow$ custom data type conversion for all <em>relevant</em> data types in their systems</li>
</ul>
</section><section>
<h2 id="serialization-in-python-attempt-1">Serialization in Python (attempt 1)</h2>
<div class="container w-100 m-0 p-0">
    <div class="row "><div class="col col-5" style="text-align: left;"><div class="highlight"><pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="nohighlight" data-noescape=""><span style="display:flex;"><span><span style="color:#204a87;font-weight:bold">from</span> <span style="color:#000">snippets.lab4.users</span> <span style="color:#204a87;font-weight:bold">import</span> <span style="color:#000">User</span><span style="color:#000;font-weight:bold">,</span> <span style="color:#000">Role</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#000">to_serialize</span> <span style="color:#ce5c00;font-weight:bold">=</span> <span style="color:#000">User</span><span style="color:#000;font-weight:bold">(</span>
</span></span><span style="display:flex;"><span>  <span style="color:#000">username</span><span style="color:#ce5c00;font-weight:bold">=</span><span style="color:#4e9a06">'gciatto'</span><span style="color:#000;font-weight:bold">,</span>
</span></span><span style="display:flex;"><span>  <span style="color:#000">emails</span><span style="color:#ce5c00;font-weight:bold">=</span><span style="color:#000;font-weight:bold">{</span>
</span></span><span style="display:flex;"><span>    <span style="color:#4e9a06">'giovanni.ciatto@unibo.it'</span><span style="color:#000;font-weight:bold">,</span>
</span></span><span style="display:flex;"><span>    <span style="color:#4e9a06">'giovanni.ciatto@gmail.com'</span>
</span></span><span style="display:flex;"><span>  <span style="color:#000;font-weight:bold">},</span>
</span></span><span style="display:flex;"><span>  <span style="color:#000">full_name</span><span style="color:#ce5c00;font-weight:bold">=</span><span style="color:#4e9a06">'Giovanni Ciatto'</span><span style="color:#000;font-weight:bold">,</span>
</span></span><span style="display:flex;"><span>  <span style="color:#000">role</span><span style="color:#ce5c00;font-weight:bold">=</span><span style="color:#000">Role</span><span style="color:#ce5c00;font-weight:bold">.</span><span style="color:#000">ADMIN</span><span style="color:#000;font-weight:bold">,</span>
</span></span><span style="display:flex;"><span>  <span style="color:#000">password</span><span style="color:#ce5c00;font-weight:bold">=</span><span style="color:#4e9a06">'my secret password'</span><span style="color:#000;font-weight:bold">,</span>
</span></span><span style="display:flex;"><span><span style="color:#000;font-weight:bold">)</span>
</span></span></code></pre></div></div>
<div class="col col-2" style="text-align: left;"><p>$\xrightarrow{\text{serialization}}$</p>
</div>
<div class="col col-5" style="text-align: left;"><div class="highlight"><pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="nohighlight" data-noescape=""><span style="display:flex;"><span><span style="color:#000;font-weight:bold">{</span>
</span></span><span style="display:flex;"><span>  <span style="color:#204a87;font-weight:bold">"username"</span><span style="color:#000;font-weight:bold">:</span> <span style="color:#4e9a06">"gciatto"</span><span style="color:#000;font-weight:bold">,</span>
</span></span><span style="display:flex;"><span>  <span style="color:#204a87;font-weight:bold">"emails"</span><span style="color:#000;font-weight:bold">:</span> <span style="color:#000;font-weight:bold">[</span>
</span></span><span style="display:flex;"><span>    <span style="color:#4e9a06">"giovanni.ciatto@unibo.it"</span><span style="color:#000;font-weight:bold">,</span>
</span></span><span style="display:flex;"><span>    <span style="color:#4e9a06">"giovanni.ciatto@gmail.com"</span>
</span></span><span style="display:flex;"><span>  <span style="color:#000;font-weight:bold">],</span>
</span></span><span style="display:flex;"><span>  <span style="color:#204a87;font-weight:bold">"full_name"</span><span style="color:#000;font-weight:bold">:</span> <span style="color:#4e9a06">"Giovanni Ciatto"</span><span style="color:#000;font-weight:bold">,</span>
</span></span><span style="display:flex;"><span>  <span style="color:#204a87;font-weight:bold">"role"</span><span style="color:#000;font-weight:bold">:</span> <span style="color:#000;font-weight:bold">{</span><span style="color:#204a87;font-weight:bold">"name"</span><span style="color:#000;font-weight:bold">:</span> <span style="color:#4e9a06">"ADMIN"</span><span style="color:#000;font-weight:bold">},</span>
</span></span><span style="display:flex;"><span>  <span style="color:#204a87;font-weight:bold">"password"</span><span style="color:#000;font-weight:bold">:</span> <span style="color:#4e9a06">"my secret password"</span><span style="color:#000;font-weight:bold">,</span>
</span></span><span style="display:flex;"><span><span style="color:#000;font-weight:bold">}</span>
</span></span></code></pre></div></div>
</div>
</div>
<p>Let’s implement a serializer:</p>
<div class="container w-100 m-0 p-0">
    <div class="row "><div class="col col-8" style="text-align: left;"><div class="highlight"><pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="nohighlight" data-noescape=""><span style="display:flex;"><span><span style="color:#204a87;font-weight:bold">class</span> <span style="color:#000">Serializer</span><span style="color:#000;font-weight:bold">:</span>
</span></span><span style="display:flex;"><span>    <span style="color:#204a87;font-weight:bold">def</span> <span style="color:#000">serialize</span><span style="color:#000;font-weight:bold">(</span><span style="color:#3465a4">self</span><span style="color:#000;font-weight:bold">,</span> <span style="color:#000">obj</span><span style="color:#000;font-weight:bold">:</span> <span style="color:#204a87">object</span><span style="color:#000;font-weight:bold">)</span> <span style="color:#ce5c00;font-weight:bold">-&gt;</span> <span style="color:#204a87">str</span><span style="color:#000;font-weight:bold">:</span>
</span></span><span style="display:flex;"><span>        <span style="color:#204a87;font-weight:bold">return</span> <span style="color:#3465a4">self</span><span style="color:#ce5c00;font-weight:bold">.</span><span style="color:#000">_ast_to_string</span><span style="color:#000;font-weight:bold">(</span><span style="color:#3465a4">self</span><span style="color:#ce5c00;font-weight:bold">.</span><span style="color:#000">_to_ast</span><span style="color:#000;font-weight:bold">(</span><span style="color:#000">obj</span><span style="color:#000;font-weight:bold">))</span> <span style="color:#8f5902;font-style:italic"># objct -&gt; AST -&gt; JSON string</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#204a87;font-weight:bold">def</span> <span style="color:#000">_ast_to_string</span><span style="color:#000;font-weight:bold">(</span><span style="color:#3465a4">self</span><span style="color:#000;font-weight:bold">,</span> <span style="color:#000">data</span><span style="color:#000;font-weight:bold">):</span>
</span></span><span style="display:flex;"><span>        <span style="color:#204a87;font-weight:bold">return</span> <span style="color:#000">json</span><span style="color:#ce5c00;font-weight:bold">.</span><span style="color:#000">dumps</span><span style="color:#000;font-weight:bold">(</span><span style="color:#000">data</span><span style="color:#000;font-weight:bold">,</span> <span style="color:#000">indent</span><span style="color:#ce5c00;font-weight:bold">=</span><span style="color:#0000cf;font-weight:bold">2</span><span style="color:#000;font-weight:bold">)</span> <span style="color:#8f5902;font-style:italic"># AST -&gt; JSON string</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#8f5902;font-style:italic"># here we select which conversion to apply based on the type of obj</span>
</span></span><span style="display:flex;"><span>    <span style="color:#204a87;font-weight:bold">def</span> <span style="color:#000">_to_ast</span><span style="color:#000;font-weight:bold">(</span><span style="color:#3465a4">self</span><span style="color:#000;font-weight:bold">,</span> <span style="color:#000">obj</span><span style="color:#000;font-weight:bold">:</span> <span style="color:#204a87">object</span><span style="color:#000;font-weight:bold">)</span> <span style="color:#ce5c00;font-weight:bold">-&gt;</span> <span style="color:#204a87">object</span><span style="color:#000;font-weight:bold">:</span>
</span></span><span style="display:flex;"><span>        <span style="color:#204a87;font-weight:bold">if</span> <span style="color:#204a87">isinstance</span><span style="color:#000;font-weight:bold">(</span><span style="color:#000">obj</span><span style="color:#000;font-weight:bold">,</span> <span style="color:#000">User</span><span style="color:#000;font-weight:bold">):</span>
</span></span><span style="display:flex;"><span>            <span style="color:#204a87;font-weight:bold">return</span> <span style="color:#3465a4">self</span><span style="color:#ce5c00;font-weight:bold">.</span><span style="color:#000">_user_to_ast</span><span style="color:#000;font-weight:bold">(</span><span style="color:#000">obj</span><span style="color:#000;font-weight:bold">)</span>
</span></span><span style="display:flex;"><span>        <span style="color:#204a87;font-weight:bold">elif</span> <span style="color:#204a87">isinstance</span><span style="color:#000;font-weight:bold">(</span><span style="color:#000">obj</span><span style="color:#000;font-weight:bold">,</span> <span style="color:#000">Role</span><span style="color:#000;font-weight:bold">):</span>
</span></span><span style="display:flex;"><span>            <span style="color:#204a87;font-weight:bold">return</span> <span style="color:#3465a4">self</span><span style="color:#ce5c00;font-weight:bold">.</span><span style="color:#000">_role_to_ast</span><span style="color:#000;font-weight:bold">(</span><span style="color:#000">obj</span><span style="color:#000;font-weight:bold">)</span>
</span></span><span style="display:flex;"><span>        <span style="color:#204a87;font-weight:bold">else</span><span style="color:#000;font-weight:bold">:</span>
</span></span><span style="display:flex;"><span>            <span style="color:#204a87;font-weight:bold">raise</span> <span style="color:#c00;font-weight:bold">ValueError</span><span style="color:#000;font-weight:bold">(</span><span style="color:#4e9a06">f</span><span style="color:#4e9a06">'unsupported type: </span><span style="color:#4e9a06">{</span><span style="color:#204a87">type</span><span style="color:#000;font-weight:bold">(</span><span style="color:#000">obj</span><span style="color:#000;font-weight:bold">)</span><span style="color:#4e9a06">}</span><span style="color:#4e9a06">'</span><span style="color:#000;font-weight:bold">)</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#204a87;font-weight:bold">def</span> <span style="color:#000">_user_to_ast</span><span style="color:#000;font-weight:bold">(</span><span style="color:#3465a4">self</span><span style="color:#000;font-weight:bold">,</span> <span style="color:#000">user</span><span style="color:#000;font-weight:bold">:</span> <span style="color:#000">User</span><span style="color:#000;font-weight:bold">)</span> <span style="color:#ce5c00;font-weight:bold">-&gt;</span> <span style="color:#204a87">dict</span><span style="color:#000;font-weight:bold">:</span> <span style="color:#8f5902;font-style:italic"># User -&gt; AST</span>
</span></span><span style="display:flex;"><span>        <span style="color:#204a87;font-weight:bold">return</span> <span style="color:#000;font-weight:bold">{</span>
</span></span><span style="display:flex;"><span>            <span style="color:#4e9a06">'username'</span><span style="color:#000;font-weight:bold">:</span> <span style="color:#000">user</span><span style="color:#ce5c00;font-weight:bold">.</span><span style="color:#000">username</span><span style="color:#000;font-weight:bold">,</span>
</span></span><span style="display:flex;"><span>            <span style="color:#4e9a06">'emails'</span><span style="color:#000;font-weight:bold">:</span> <span style="color:#204a87">list</span><span style="color:#000;font-weight:bold">(</span><span style="color:#000">user</span><span style="color:#ce5c00;font-weight:bold">.</span><span style="color:#000">emails</span><span style="color:#000;font-weight:bold">),</span>
</span></span><span style="display:flex;"><span>            <span style="color:#4e9a06">'full_name'</span><span style="color:#000;font-weight:bold">:</span> <span style="color:#000">user</span><span style="color:#ce5c00;font-weight:bold">.</span><span style="color:#000">full_name</span><span style="color:#000;font-weight:bold">,</span>
</span></span><span style="display:flex;"><span>            <span style="color:#4e9a06">'role'</span><span style="color:#000;font-weight:bold">:</span> <span style="color:#3465a4">self</span><span style="color:#ce5c00;font-weight:bold">.</span><span style="color:#000">_role_to_ast</span><span style="color:#000;font-weight:bold">(</span><span style="color:#000">user</span><span style="color:#ce5c00;font-weight:bold">.</span><span style="color:#000">role</span><span style="color:#000;font-weight:bold">),</span>
</span></span><span style="display:flex;"><span>            <span style="color:#4e9a06">'password'</span><span style="color:#000;font-weight:bold">:</span> <span style="color:#000">user</span><span style="color:#ce5c00;font-weight:bold">.</span><span style="color:#000">password</span><span style="color:#000;font-weight:bold">,</span>
</span></span><span style="display:flex;"><span>        <span style="color:#000;font-weight:bold">}</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#204a87;font-weight:bold">def</span> <span style="color:#000">_role_to_ast</span><span style="color:#000;font-weight:bold">(</span><span style="color:#3465a4">self</span><span style="color:#000;font-weight:bold">,</span> <span style="color:#000">role</span><span style="color:#000;font-weight:bold">:</span> <span style="color:#000">Role</span><span style="color:#000;font-weight:bold">)</span> <span style="color:#ce5c00;font-weight:bold">-&gt;</span> <span style="color:#204a87">dict</span><span style="color:#000;font-weight:bold">:</span> <span style="color:#8f5902;font-style:italic"># Role -&gt; AST</span>
</span></span><span style="display:flex;"><span>        <span style="color:#204a87;font-weight:bold">return</span> <span style="color:#000;font-weight:bold">{</span><span style="color:#4e9a06">'name'</span><span style="color:#000;font-weight:bold">:</span> <span style="color:#000">role</span><span style="color:#ce5c00;font-weight:bold">.</span><span style="color:#000">name</span><span style="color:#000;font-weight:bold">}</span>
</span></span></code></pre></div></div>
<div class="col " style="text-align: left;"><figure id="plantuml-figure-1728378405316300678" class="plantuml" alt="" style="width: 100%;max-width: 95vw;max-height: 80vh;">
<p>class Serializer {
+serialize(obj: object) : str
-_ast_to_string(data) : str
-_to_ast(obj: object) : object
-_user_to_ast(user: User) : dict
-_role_to_ast(role: Role) : dict
}</p>
</figure>
<script>
    handlePlantumlFigureByID("plantuml-figure-1728378405316300678");
</script>
</div>
</div>
</div>
<div class="highlight"><pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="nohighlight" data-noescape=""><span style="display:flex;"><span><span style="color:#000">serializer</span> <span style="color:#ce5c00;font-weight:bold">=</span> <span style="color:#000">Serializer</span><span style="color:#000;font-weight:bold">()</span>
</span></span><span style="display:flex;"><span><span style="color:#204a87">print</span><span style="color:#000;font-weight:bold">(</span><span style="color:#000">serializer</span><span style="color:#ce5c00;font-weight:bold">.</span><span style="color:#000">serialize</span><span style="color:#000;font-weight:bold">(</span><span style="color:#000">to_serialize</span><span style="color:#000;font-weight:bold">))</span> <span style="color:#8f5902;font-style:italic"># prints the JSON document</span>
</span></span></code></pre></div></section><section>
<h2 id="deserialization-in-python-attempt-1">Deserialization in Python (attempt 1)</h2>
<div class="container w-100 m-0 p-0">
    <div class="row "><div class="col col-5" style="text-align: left;"><div class="highlight"><pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="nohighlight" data-noescape=""><span style="display:flex;"><span><span style="color:#000">to_deserialize</span> <span style="color:#ce5c00;font-weight:bold">=</span> <span style="color:#4e9a06">"""{
</span></span></span><span style="display:flex;"><span><span style="color:#4e9a06">  "username": "gciatto",
</span></span></span><span style="display:flex;"><span><span style="color:#4e9a06">  "emails": [
</span></span></span><span style="display:flex;"><span><span style="color:#4e9a06">    "giovanni.ciatto@unibo.it",
</span></span></span><span style="display:flex;"><span><span style="color:#4e9a06">    "giovanni.ciatto@gmail.com"
</span></span></span><span style="display:flex;"><span><span style="color:#4e9a06">  ],
</span></span></span><span style="display:flex;"><span><span style="color:#4e9a06">  "full_name": "Giovanni Ciatto",
</span></span></span><span style="display:flex;"><span><span style="color:#4e9a06">  "role": {"name": "ADMIN"},
</span></span></span><span style="display:flex;"><span><span style="color:#4e9a06">  "password": "my secret password",
</span></span></span><span style="display:flex;"><span><span style="color:#4e9a06">}"""</span>
</span></span></code></pre></div></div>
<div class="col col-2" style="text-align: left;"><p>$\xrightarrow{\text{deserialization}}$</p>
</div>
<div class="col col-5" style="text-align: left;"><div class="highlight"><pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="nohighlight" data-noescape=""><span style="display:flex;"><span><span style="color:#204a87;font-weight:bold">from</span> <span style="color:#000">snippets.lab4.users</span> <span style="color:#204a87;font-weight:bold">import</span> <span style="color:#000">User</span><span style="color:#000;font-weight:bold">,</span> <span style="color:#000">Role</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#000">result</span> <span style="color:#ce5c00;font-weight:bold">=</span> <span style="color:#000">User</span><span style="color:#000;font-weight:bold">(</span>
</span></span><span style="display:flex;"><span>  <span style="color:#000">username</span><span style="color:#ce5c00;font-weight:bold">=</span><span style="color:#4e9a06">'gciatto'</span><span style="color:#000;font-weight:bold">,</span>
</span></span><span style="display:flex;"><span>  <span style="color:#000">emails</span><span style="color:#ce5c00;font-weight:bold">=</span><span style="color:#000;font-weight:bold">{</span>
</span></span><span style="display:flex;"><span>    <span style="color:#4e9a06">'giovanni.ciatto@unibo.it'</span><span style="color:#000;font-weight:bold">,</span>
</span></span><span style="display:flex;"><span>    <span style="color:#4e9a06">'giovanni.ciatto@gmail.com'</span>
</span></span><span style="display:flex;"><span>  <span style="color:#000;font-weight:bold">},</span>
</span></span><span style="display:flex;"><span>  <span style="color:#000">full_name</span><span style="color:#ce5c00;font-weight:bold">=</span><span style="color:#4e9a06">'Giovanni Ciatto'</span><span style="color:#000;font-weight:bold">,</span>
</span></span><span style="display:flex;"><span>  <span style="color:#000">role</span><span style="color:#ce5c00;font-weight:bold">=</span><span style="color:#000">Role</span><span style="color:#ce5c00;font-weight:bold">.</span><span style="color:#000">ADMIN</span><span style="color:#000;font-weight:bold">,</span>
</span></span><span style="display:flex;"><span>  <span style="color:#000">password</span><span style="color:#ce5c00;font-weight:bold">=</span><span style="color:#4e9a06">'my secret password'</span><span style="color:#000;font-weight:bold">,</span>
</span></span><span style="display:flex;"><span><span style="color:#000;font-weight:bold">)</span>
</span></span></code></pre></div></div>
</div>
</div>
<div class="container w-100 m-0 p-0">
    <div class="row "><div class="col col-8" style="text-align: left;"><div class="highlight"><pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="nohighlight" data-noescape=""><span style="display:flex;"><span><span style="color:#204a87;font-weight:bold">class</span> <span style="color:#000">Deserializer</span><span style="color:#000;font-weight:bold">:</span>
</span></span><span style="display:flex;"><span>    <span style="color:#204a87;font-weight:bold">def</span> <span style="color:#000">deserialize</span><span style="color:#000;font-weight:bold">(</span><span style="color:#3465a4">self</span><span style="color:#000;font-weight:bold">,</span> <span style="color:#000">string</span><span style="color:#000;font-weight:bold">):</span>
</span></span><span style="display:flex;"><span>        <span style="color:#204a87;font-weight:bold">return</span> <span style="color:#3465a4">self</span><span style="color:#ce5c00;font-weight:bold">.</span><span style="color:#000">_ast_to_obj</span><span style="color:#000;font-weight:bold">(</span><span style="color:#3465a4">self</span><span style="color:#ce5c00;font-weight:bold">.</span><span style="color:#000">_ast_to_string</span><span style="color:#000;font-weight:bold">(</span><span style="color:#000">string</span><span style="color:#000;font-weight:bold">))</span> <span style="color:#8f5902;font-style:italic"># JSON string -&gt; AST -&gt; object</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#204a87;font-weight:bold">def</span> <span style="color:#000">_ast_to_string</span><span style="color:#000;font-weight:bold">(</span><span style="color:#3465a4">self</span><span style="color:#000;font-weight:bold">,</span> <span style="color:#000">data</span><span style="color:#000;font-weight:bold">):</span>
</span></span><span style="display:flex;"><span>        <span style="color:#204a87;font-weight:bold">return</span> <span style="color:#000">json</span><span style="color:#ce5c00;font-weight:bold">.</span><span style="color:#000">loads</span><span style="color:#000;font-weight:bold">(</span><span style="color:#000">data</span><span style="color:#000;font-weight:bold">)</span>  <span style="color:#8f5902;font-style:italic"># JSON string -&gt; AST</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#8f5902;font-style:italic"># here we select which conversion to apply based which keys are present in the AST</span>
</span></span><span style="display:flex;"><span>    <span style="color:#204a87;font-weight:bold">def</span> <span style="color:#000">_ast_to_obj</span><span style="color:#000;font-weight:bold">(</span><span style="color:#3465a4">self</span><span style="color:#000;font-weight:bold">,</span> <span style="color:#000">data</span><span style="color:#000;font-weight:bold">)</span> <span style="color:#ce5c00;font-weight:bold">-&gt;</span> <span style="color:#204a87">object</span><span style="color:#000;font-weight:bold">:</span>
</span></span><span style="display:flex;"><span>        <span style="color:#204a87;font-weight:bold">if</span> <span style="color:#204a87">all</span><span style="color:#000;font-weight:bold">(</span><span style="color:#000">k</span> <span style="color:#204a87;font-weight:bold">in</span> <span style="color:#000">data</span> <span style="color:#204a87;font-weight:bold">for</span> <span style="color:#000">k</span> <span style="color:#204a87;font-weight:bold">in</span> <span style="color:#000;font-weight:bold">[</span><span style="color:#4e9a06">'username'</span><span style="color:#000;font-weight:bold">,</span> <span style="color:#4e9a06">'emails'</span><span style="color:#000;font-weight:bold">,</span> <span style="color:#4e9a06">'full_name'</span><span style="color:#000;font-weight:bold">,</span> <span style="color:#4e9a06">'role'</span><span style="color:#000;font-weight:bold">,</span> <span style="color:#4e9a06">'password'</span><span style="color:#000;font-weight:bold">]):</span>
</span></span><span style="display:flex;"><span>            <span style="color:#204a87;font-weight:bold">return</span> <span style="color:#3465a4">self</span><span style="color:#ce5c00;font-weight:bold">.</span><span style="color:#000">_user_from_ast</span><span style="color:#000;font-weight:bold">(</span><span style="color:#000">data</span><span style="color:#000;font-weight:bold">)</span>
</span></span><span style="display:flex;"><span>        <span style="color:#204a87;font-weight:bold">elif</span> <span style="color:#4e9a06">'name'</span> <span style="color:#204a87;font-weight:bold">in</span> <span style="color:#000">data</span><span style="color:#000;font-weight:bold">:</span>
</span></span><span style="display:flex;"><span>            <span style="color:#204a87;font-weight:bold">return</span> <span style="color:#3465a4">self</span><span style="color:#ce5c00;font-weight:bold">.</span><span style="color:#000">_role_from_ast</span><span style="color:#000;font-weight:bold">(</span><span style="color:#000">data</span><span style="color:#000;font-weight:bold">)</span>
</span></span><span style="display:flex;"><span>        <span style="color:#204a87;font-weight:bold">else</span><span style="color:#000;font-weight:bold">:</span>
</span></span><span style="display:flex;"><span>            <span style="color:#204a87;font-weight:bold">raise</span> <span style="color:#c00;font-weight:bold">ValueError</span><span style="color:#000;font-weight:bold">(</span><span style="color:#4e9a06">f</span><span style="color:#4e9a06">'unsupported data: </span><span style="color:#4e9a06">{</span><span style="color:#000">data</span><span style="color:#4e9a06">}</span><span style="color:#4e9a06">'</span><span style="color:#000;font-weight:bold">)</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#204a87;font-weight:bold">def</span> <span style="color:#000">_user_from_ast</span><span style="color:#000;font-weight:bold">(</span><span style="color:#3465a4">self</span><span style="color:#000;font-weight:bold">,</span> <span style="color:#000">data</span><span style="color:#000;font-weight:bold">)</span> <span style="color:#ce5c00;font-weight:bold">-&gt;</span> <span style="color:#000">User</span><span style="color:#000;font-weight:bold">:</span> <span style="color:#8f5902;font-style:italic"># AST -&gt; User</span>
</span></span><span style="display:flex;"><span>        <span style="color:#204a87;font-weight:bold">return</span> <span style="color:#000">User</span><span style="color:#000;font-weight:bold">(</span>
</span></span><span style="display:flex;"><span>            <span style="color:#000">username</span><span style="color:#ce5c00;font-weight:bold">=</span><span style="color:#000">data</span><span style="color:#000;font-weight:bold">[</span><span style="color:#4e9a06">'username'</span><span style="color:#000;font-weight:bold">],</span>
</span></span><span style="display:flex;"><span>            <span style="color:#000">emails</span><span style="color:#ce5c00;font-weight:bold">=</span><span style="color:#204a87">set</span><span style="color:#000;font-weight:bold">(</span><span style="color:#000">data</span><span style="color:#000;font-weight:bold">[</span><span style="color:#4e9a06">'emails'</span><span style="color:#000;font-weight:bold">]),</span>
</span></span><span style="display:flex;"><span>            <span style="color:#000">full_name</span><span style="color:#ce5c00;font-weight:bold">=</span><span style="color:#000">data</span><span style="color:#000;font-weight:bold">[</span><span style="color:#4e9a06">'full_name'</span><span style="color:#000;font-weight:bold">],</span>
</span></span><span style="display:flex;"><span>            <span style="color:#000">role</span><span style="color:#ce5c00;font-weight:bold">=</span><span style="color:#3465a4">self</span><span style="color:#ce5c00;font-weight:bold">.</span><span style="color:#000">_ast_to_obj</span><span style="color:#000;font-weight:bold">(</span><span style="color:#000">data</span><span style="color:#000;font-weight:bold">[</span><span style="color:#4e9a06">'role'</span><span style="color:#000;font-weight:bold">]),</span> <span style="color:#8f5902;font-style:italic"># recursive call!</span>
</span></span><span style="display:flex;"><span>            <span style="color:#000">password</span><span style="color:#ce5c00;font-weight:bold">=</span><span style="color:#000">data</span><span style="color:#000;font-weight:bold">[</span><span style="color:#4e9a06">'password'</span><span style="color:#000;font-weight:bold">],</span>
</span></span><span style="display:flex;"><span>        <span style="color:#000;font-weight:bold">)</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#204a87;font-weight:bold">def</span> <span style="color:#000">_role_from_ast</span><span style="color:#000;font-weight:bold">(</span><span style="color:#3465a4">self</span><span style="color:#000;font-weight:bold">,</span> <span style="color:#000">data</span><span style="color:#000;font-weight:bold">)</span> <span style="color:#ce5c00;font-weight:bold">-&gt;</span> <span style="color:#000">Role</span><span style="color:#000;font-weight:bold">:</span> <span style="color:#8f5902;font-style:italic"># AST -&gt; Role</span>
</span></span><span style="display:flex;"><span>        <span style="color:#204a87;font-weight:bold">return</span> <span style="color:#000">Role</span><span style="color:#000;font-weight:bold">[</span><span style="color:#000">data</span><span style="color:#000;font-weight:bold">[</span><span style="color:#4e9a06">'name'</span><span style="color:#000;font-weight:bold">]]</span>
</span></span></code></pre></div></div>
<div class="col " style="text-align: left;"><figure id="plantuml-figure-1728378405321316445" class="plantuml" alt="" style="width: 100%;max-width: 95vw;max-height: 80vh;">
<p>class Deserializer {
+deserialize(string) : object
-_ast_to_string(data) : object
-_ast_to_obj(data) : object
-_user_from_ast(data) : User
-_role_from_ast(data) : Role
}</p>
</figure>
<script>
    handlePlantumlFigureByID("plantuml-figure-1728378405321316445");
</script>
</div>
</div>
</div>
<div class="highlight"><pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="nohighlight" data-noescape=""><span style="display:flex;"><span><span style="color:#000">deserializer</span> <span style="color:#ce5c00;font-weight:bold">=</span> <span style="color:#000">Deserializer</span><span style="color:#000;font-weight:bold">()</span>
</span></span><span style="display:flex;"><span><span style="color:#204a87">print</span><span style="color:#000;font-weight:bold">(</span><span style="color:#000">deserializer</span><span style="color:#ce5c00;font-weight:bold">.</span><span style="color:#000">deserialize</span><span style="color:#000;font-weight:bold">(</span><span style="color:#000">to_deserialize</span><span style="color:#000;font-weight:bold">)</span> <span style="color:#ce5c00;font-weight:bold">==</span> <span style="color:#000">result</span><span style="color:#000;font-weight:bold">)</span> <span style="color:#8f5902;font-style:italic"># prints True</span>
</span></span></code></pre></div></section><section>
<h2 id="analysis-of-the-current-approach">Analysis of the current approach</h2>
<ul>
<li>
<p><strong>Pros</strong>:</p>
<ul>
<li>one method per <em>data type</em> to (de)serialize</li>
<li><em>automatically</em> understands <em>how</em> to (de)serilize the provided object/string</li>
<li>raises error on attempt to (de)serialize an <em>unsupported</em> data type</li>
<li>raises error on attempt to (de)serialize <em>invalid</em> data (e.g. missing fields)</li>
<li><em>easy</em> to <em>extend</em> to support <em>new</em> data types
<ol>
<li>requires adding <em>one more</em> method to the <code>Serializer</code> and <code>Deserializer</code> for the <em>new</em> data type</li>
<li>requires <em>modifying</em> the <code>_to_ast</code> and <code>_ast_to_obj</code> methods to <em>select</em> the <em>new</em> method</li>
</ol>
</li>
</ul>
</li>
<li>
<p><strong>Cons</strong>:</p>
<ul>
<li>quite <em>verbose</em> and <em>repetitive</em></li>
<li>the <em>type</em> of the <em>object</em> to <em>de</em>serialize is <strong>inferred</strong> from the <em>keys</em> present in the <em>AST</em>
<ul>
<li>this may lead to <em>ambiguities</em> if <em>different</em> data types <em>share</em> the <em>same</em> <em>keys</em>
<ul>
<li>e.g. what if <em>another</em> data type has a <code>name</code> key (other than <code>Role</code>)?</li>
</ul>
</li>
<li>this may lead to <em>errors</em> if <em>some</em> <em>keys</em> are <em>missing</em> in the <em>AST</em></li>
</ul>
</li>
</ul>
</li>
</ul>
</section><section>
<h2 id="deserialization-in-python-attempt-2">(De)Serialization in Python (attempt 2)</h2>
<p><strong>Improvement</strong>: <em>explicitly</em> <em>tag</em> the <em>type</em> of the object to <em>serialize</em> in the <em>AST</em>, and use this tag to <em>select</em> the right method to <em><strong>de</strong>serialize</em></p>
<div class="container w-100 m-0 p-0">
    <div class="row "><div class="col col-5" style="text-align: left;"><div class="highlight"><pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="nohighlight" data-noescape=""><span style="display:flex;"><span><span style="color:#204a87;font-weight:bold">from</span> <span style="color:#000">snippets.lab4.users</span> <span style="color:#204a87;font-weight:bold">import</span> <span style="color:#000">User</span><span style="color:#000;font-weight:bold">,</span> <span style="color:#000">Role</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#000">User</span><span style="color:#000;font-weight:bold">(</span>
</span></span><span style="display:flex;"><span>    <span style="color:#000">username</span><span style="color:#ce5c00;font-weight:bold">=</span><span style="color:#4e9a06">'gciatto'</span><span style="color:#000;font-weight:bold">,</span>
</span></span><span style="display:flex;"><span>    <span style="color:#000">emails</span><span style="color:#ce5c00;font-weight:bold">=</span><span style="color:#000;font-weight:bold">{</span>
</span></span><span style="display:flex;"><span>        <span style="color:#4e9a06">'giovanni.ciatto@unibo.it'</span><span style="color:#000;font-weight:bold">,</span>
</span></span><span style="display:flex;"><span>        <span style="color:#4e9a06">'giovanni.ciatto@gmail.com'</span>
</span></span><span style="display:flex;"><span>    <span style="color:#000;font-weight:bold">},</span>
</span></span><span style="display:flex;"><span>    <span style="color:#000">full_name</span><span style="color:#ce5c00;font-weight:bold">=</span><span style="color:#4e9a06">'Giovanni Ciatto'</span><span style="color:#000;font-weight:bold">,</span>
</span></span><span style="display:flex;"><span>    <span style="color:#000">role</span><span style="color:#ce5c00;font-weight:bold">=</span><span style="color:#000">Role</span><span style="color:#ce5c00;font-weight:bold">.</span><span style="color:#000">ADMIN</span><span style="color:#000;font-weight:bold">,</span>
</span></span><span style="display:flex;"><span>    <span style="color:#000">password</span><span style="color:#ce5c00;font-weight:bold">=</span><span style="color:#4e9a06">'my secret password'</span><span style="color:#000;font-weight:bold">,</span>
</span></span><span style="display:flex;"><span><span style="color:#000;font-weight:bold">)</span>
</span></span></code></pre></div></div>
<div class="col col-2" style="text-align: left;"><p>$\xrightarrow{\text{serialization}}$</p>
<p>$\xleftarrow{\text{deserialization}}$</p>
</div>
<div class="col col-5" style="text-align: left;"><div class="highlight"><pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="nohighlight" data-noescape=""><span style="display:flex;"><span><span style="color:#000;font-weight:bold">{</span>
</span></span><span style="display:flex;"><span>    <span style="color:#204a87;font-weight:bold">"username"</span><span style="color:#000;font-weight:bold">:</span> <span style="color:#4e9a06">"gciatto"</span><span style="color:#000;font-weight:bold">,</span>
</span></span><span style="display:flex;"><span>    <span style="color:#204a87;font-weight:bold">"emails"</span><span style="color:#000;font-weight:bold">:</span> <span style="color:#000;font-weight:bold">[</span>
</span></span><span style="display:flex;"><span>        <span style="color:#4e9a06">"giovanni.ciatto@unibo.it"</span><span style="color:#000;font-weight:bold">,</span>
</span></span><span style="display:flex;"><span>        <span style="color:#4e9a06">"giovanni.ciatto@gmail.com"</span>
</span></span><span style="display:flex;"><span>    <span style="color:#000;font-weight:bold">],</span>
</span></span><span style="display:flex;"><span>    <span style="color:#204a87;font-weight:bold">"full_name"</span><span style="color:#000;font-weight:bold">:</span> <span style="color:#4e9a06">"Giovanni Ciatto"</span><span style="color:#000;font-weight:bold">,</span>
</span></span><span style="display:flex;"><span>    <span style="color:#204a87;font-weight:bold">"role"</span><span style="color:#000;font-weight:bold">:</span> <span style="color:#000;font-weight:bold">{</span>
</span></span><span style="display:flex;"><span>        <span style="color:#204a87;font-weight:bold">"name"</span><span style="color:#000;font-weight:bold">:</span> <span style="color:#4e9a06">"ADMIN"</span><span style="color:#000;font-weight:bold">,</span>
</span></span><span style="display:flex;"><span>        <span style="color:#204a87;font-weight:bold">"$type"</span><span style="color:#000;font-weight:bold">:</span> <span style="color:#4e9a06">"Role"</span> <span style="color:#8f5902;font-style:italic">// explicit type field
</span></span></span><span style="display:flex;"><span><span style="color:#8f5902;font-style:italic"></span>    <span style="color:#000;font-weight:bold">},</span>
</span></span><span style="display:flex;"><span>    <span style="color:#204a87;font-weight:bold">"password"</span><span style="color:#000;font-weight:bold">:</span> <span style="color:#4e9a06">"my secret password"</span><span style="color:#000;font-weight:bold">,</span>
</span></span><span style="display:flex;"><span>    <span style="color:#204a87;font-weight:bold">"$type"</span><span style="color:#000;font-weight:bold">:</span> <span style="color:#4e9a06">"User"</span> <span style="color:#8f5902;font-style:italic">// explicit type field
</span></span></span><span style="display:flex;"><span><span style="color:#8f5902;font-style:italic"></span><span style="color:#000;font-weight:bold">}</span>
</span></span></code></pre></div></div>
</div>
</div>
<p>Apply these updates to the <code>Serializer</code> and <code>Deserializer</code> classes:</p>
<div class="container w-100 m-0 p-0">
    <div class="row "><div class="col " style="text-align: left;"><div class="highlight"><pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="nohighlight" data-noescape=""><span style="display:flex;"><span><span style="color:#204a87;font-weight:bold">class</span> <span style="color:#000">Serializer</span><span style="color:#000;font-weight:bold">:</span>
</span></span><span style="display:flex;"><span>    <span style="color:#8f5902;font-style:italic"># rest of the class unchanged</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#204a87;font-weight:bold">def</span> <span style="color:#000">_to_ast</span><span style="color:#000;font-weight:bold">(</span><span style="color:#3465a4">self</span><span style="color:#000;font-weight:bold">,</span> <span style="color:#000">obj</span><span style="color:#000;font-weight:bold">:</span> <span style="color:#204a87">object</span><span style="color:#000;font-weight:bold">)</span> <span style="color:#ce5c00;font-weight:bold">-&gt;</span> <span style="color:#204a87">object</span><span style="color:#000;font-weight:bold">:</span>
</span></span><span style="display:flex;"><span>        <span style="color:#204a87;font-weight:bold">if</span> <span style="color:#204a87">isinstance</span><span style="color:#000;font-weight:bold">(</span><span style="color:#000">obj</span><span style="color:#000;font-weight:bold">,</span> <span style="color:#000">User</span><span style="color:#000;font-weight:bold">):</span>
</span></span><span style="display:flex;"><span>            <span style="color:#000">result</span> <span style="color:#ce5c00;font-weight:bold">=</span> <span style="color:#3465a4">self</span><span style="color:#ce5c00;font-weight:bold">.</span><span style="color:#000">_user_to_ast</span><span style="color:#000;font-weight:bold">(</span><span style="color:#000">obj</span><span style="color:#000;font-weight:bold">)</span>
</span></span><span style="display:flex;"><span>        <span style="color:#204a87;font-weight:bold">elif</span> <span style="color:#204a87">isinstance</span><span style="color:#000;font-weight:bold">(</span><span style="color:#000">obj</span><span style="color:#000;font-weight:bold">,</span> <span style="color:#000">Role</span><span style="color:#000;font-weight:bold">):</span>
</span></span><span style="display:flex;"><span>            <span style="color:#000">result</span> <span style="color:#ce5c00;font-weight:bold">=</span> <span style="color:#3465a4">self</span><span style="color:#ce5c00;font-weight:bold">.</span><span style="color:#000">_role_to_ast</span><span style="color:#000;font-weight:bold">(</span><span style="color:#000">obj</span><span style="color:#000;font-weight:bold">)</span>
</span></span><span style="display:flex;"><span>        <span style="color:#204a87;font-weight:bold">else</span><span style="color:#000;font-weight:bold">:</span>
</span></span><span style="display:flex;"><span>            <span style="color:#204a87;font-weight:bold">raise</span> <span style="color:#c00;font-weight:bold">ValueError</span><span style="color:#000;font-weight:bold">(</span><span style="color:#4e9a06">f</span><span style="color:#4e9a06">'unsupported type: </span><span style="color:#4e9a06">{</span><span style="color:#204a87">type</span><span style="color:#000;font-weight:bold">(</span><span style="color:#000">obj</span><span style="color:#000;font-weight:bold">)</span><span style="color:#4e9a06">}</span><span style="color:#4e9a06">'</span><span style="color:#000;font-weight:bold">)</span>
</span></span><span style="display:flex;"><span>        <span style="color:#000">result</span><span style="color:#000;font-weight:bold">[</span><span style="color:#4e9a06">'$type'</span><span style="color:#000;font-weight:bold">]</span> <span style="color:#ce5c00;font-weight:bold">=</span> <span style="color:#204a87">type</span><span style="color:#000;font-weight:bold">(</span><span style="color:#000">obj</span><span style="color:#000;font-weight:bold">)</span><span style="color:#ce5c00;font-weight:bold">.</span><span style="color:#000">__name__</span>
</span></span><span style="display:flex;"><span>        <span style="color:#204a87;font-weight:bold">return</span> <span style="color:#000">result</span>
</span></span></code></pre></div></div>
<div class="col " style="text-align: left;"><div class="highlight"><pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="nohighlight" data-noescape=""><span style="display:flex;"><span><span style="color:#204a87;font-weight:bold">class</span> <span style="color:#000">Deserializer</span><span style="color:#000;font-weight:bold">:</span>
</span></span><span style="display:flex;"><span>    <span style="color:#8f5902;font-style:italic"># rest of the class unchanged</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#204a87;font-weight:bold">def</span> <span style="color:#000">_ast_to_obj</span><span style="color:#000;font-weight:bold">(</span><span style="color:#3465a4">self</span><span style="color:#000;font-weight:bold">,</span> <span style="color:#000">data</span><span style="color:#000;font-weight:bold">)</span> <span style="color:#ce5c00;font-weight:bold">-&gt;</span> <span style="color:#204a87">object</span><span style="color:#000;font-weight:bold">:</span>
</span></span><span style="display:flex;"><span>        <span style="color:#204a87;font-weight:bold">if</span> <span style="color:#000">data</span><span style="color:#000;font-weight:bold">[</span><span style="color:#4e9a06">'$type'</span><span style="color:#000;font-weight:bold">]</span> <span style="color:#ce5c00;font-weight:bold">==</span> <span style="color:#204a87">type</span><span style="color:#000;font-weight:bold">(</span><span style="color:#000">User</span><span style="color:#000;font-weight:bold">)</span><span style="color:#ce5c00;font-weight:bold">.</span><span style="color:#000">__name__</span><span style="color:#000;font-weight:bold">:</span>
</span></span><span style="display:flex;"><span>            <span style="color:#204a87;font-weight:bold">return</span> <span style="color:#3465a4">self</span><span style="color:#ce5c00;font-weight:bold">.</span><span style="color:#000">_user_from_ast</span><span style="color:#000;font-weight:bold">(</span><span style="color:#000">data</span><span style="color:#000;font-weight:bold">)</span>
</span></span><span style="display:flex;"><span>        <span style="color:#204a87;font-weight:bold">elif</span> <span style="color:#000">data</span><span style="color:#000;font-weight:bold">[</span><span style="color:#4e9a06">'$type'</span><span style="color:#000;font-weight:bold">]</span> <span style="color:#ce5c00;font-weight:bold">==</span> <span style="color:#204a87">type</span><span style="color:#000;font-weight:bold">(</span><span style="color:#000">Role</span><span style="color:#000;font-weight:bold">)</span><span style="color:#ce5c00;font-weight:bold">.</span><span style="color:#000">__name__</span><span style="color:#000;font-weight:bold">:</span>
</span></span><span style="display:flex;"><span>            <span style="color:#204a87;font-weight:bold">return</span> <span style="color:#3465a4">self</span><span style="color:#ce5c00;font-weight:bold">.</span><span style="color:#000">_role_from_ast</span><span style="color:#000;font-weight:bold">(</span><span style="color:#000">data</span><span style="color:#000;font-weight:bold">)</span>
</span></span><span style="display:flex;"><span>        <span style="color:#204a87;font-weight:bold">else</span><span style="color:#000;font-weight:bold">:</span>
</span></span><span style="display:flex;"><span>            <span style="color:#204a87;font-weight:bold">raise</span> <span style="color:#c00;font-weight:bold">ValueError</span><span style="color:#000;font-weight:bold">(</span><span style="color:#4e9a06">f</span><span style="color:#4e9a06">'unsupported data: </span><span style="color:#4e9a06">{</span><span style="color:#000">data</span><span style="color:#4e9a06">}</span><span style="color:#4e9a06">'</span><span style="color:#000;font-weight:bold">)</span>
</span></span></code></pre></div></div>
</div>
</div>
<ul>
<li>Let’s use <code>$type</code> as the type tag <em>key</em>:
<ul>
<li>the <em>dollar</em> is just a character that is <em>unlikely</em> to be used in <em>real</em> data to minimize the risk of <em>collisions</em>
<ul>
<li>(but any other unlikely character would work as well)</li>
</ul>
</li>
</ul>
</li>
</ul>

</section>
</section><section>


<section data-shortcode-section="">
<h2 id="rpc">RPC</h2>
<p>Definition</p>
</section><section>
<h2 id="marshalling-and-unmarshalling">Marshalling and Unmarshalling</h2>
<p>Definition</p>
</section><section>
<h2 id="request-and-response-types-in-rpc">Request and Response Types in RPC</h2>
<p>Class diagram</p>
<p>Sequence diagram</p>

</section>
</section><section>


<section data-shortcode-section="">
<h1 id="running-example-authentication-service">Running Example: Authentication Service</h1>
<p>Part 2</p>
</section><section>
<h2 id="modelling-the-presentation-layer">Modelling the presentation layer</h2>
<p>Class diagram</p>
</section><section>
<h2 id="implementing-the-presentation-layer">Implementing the presentation layer</h2>
<p>Explicit type convention</p>
<p>Show example 1</p>

</section>
</section><section>


<section data-shortcode-section="">
<h2 id="client-and-server-stubs-for-the-authentication-service">Client and Server Stubs for the Authentication Service</h2>
<p>Class diagram</p>
<p>Sequence diagram</p>
<p>Code examples</p>

</section>
</section><section>
<h1 id="lecture-is-over">Lecture is Over</h1>
<br>
<p>Compiled on: 2024-10-08
 — <a href="?print-pdf&amp;pdfSeparateFragments=false"><i class="fa fa-print" aria-hidden="true"></i> printable version</a></p>
<p><a href="../#/toc"><i class="fa fa-undo" aria-hidden="true"></i> back to ToC</a></p>
</section>

  


</div>
      

    </div>
<script type="text/javascript" src="/slides-module2/reveal-hugo/object-assign.js"></script>

<a href="/slides-module2/reveal-js/dist/print/" id="print-location" style="display: none;"></a>

<script type="application/json" id="reveal-hugo-site-params">{"custom_theme":"custom-theme.scss","custom_theme_compile":true,"custom_theme_options":{"enablesourcemap":true,"targetpath":"css/custom-theme.css"},"height":"1080","highlight_theme":"solarized-dark","history":true,"mermaid":[{}],"slide_number":true,"theme":"league","transition":"slide","transition_speed":"fast","width":"1920"}</script>
<script type="application/json" id="reveal-hugo-page-params">null</script>

<script src="/slides-module2/reveal-js/dist/reveal.js"></script>


  
  
  <script type="text/javascript" src="/slides-module2/reveal-js/plugin/markdown/markdown.js"></script>
  
  <script type="text/javascript" src="/slides-module2/reveal-js/plugin/highlight/highlight.js"></script>
  
  <script type="text/javascript" src="/slides-module2/reveal-js/plugin/zoom/zoom.js"></script>
  
  <script type="text/javascript" src="/slides-module2/reveal-js/plugin/notes/notes.js"></script>
  
  
  <script type="text/javascript" src="/slides-module2/reveal-js/plugin/notes/notes.js"></script>




<script type="text/javascript">
  
  
  function camelize(map) {
    if (map) {
      Object.keys(map).forEach(function(k) {
        newK = k.replace(/(\_\w)/g, function(m) { return m[1].toUpperCase() });
        if (newK != k) {
          map[newK] = map[k];
          delete map[k];
        }
      });
    }
    return map;
  }

  var revealHugoDefaults = { center: true, controls: true, history: true, progress: true, transition: "slide" };

  var revealHugoPlugins = { 
    plugins: [ RevealMarkdown, RevealHighlight, RevealNotes, RevealZoom ]
   };
  var revealHugoSiteParams = JSON.parse(document.getElementById('reveal-hugo-site-params').innerHTML);
  var revealHugoPageParams = JSON.parse(document.getElementById('reveal-hugo-page-params').innerHTML);
  
  var options = Object.assign({},
    camelize(revealHugoDefaults),
    camelize(revealHugoSiteParams),
    camelize(revealHugoPageParams),
    camelize(revealHugoPlugins));
  Reveal.initialize(options);
</script>






  

  

  

  

  

  

  
    
  

  
    
  

  



  <script src="https://cdn.jsdelivr.net/npm/mermaid@9.1.6/dist/mermaid.min.js"></script>
  <script>
    mermaid.initialize({});

    let render = (event) => {
      let mermaidElems = event.currentSlide.querySelectorAll('.mermaid');
      if (!mermaidElems.length){
          return
      }
      mermaidElems.forEach(mermaidElem => {
          let processed = mermaidElem.getAttribute('data-processed');
          if (!processed){
              
              mermaid.init(undefined, mermaidElem);
          }
      });
    };
    
    render({currentSlide: Reveal.getCurrentSlide()});

    Reveal.on('slidechanged', render);
    Reveal.on('ready', render);
  </script>

    <script>
    MathJax = {
      tex: {
        inlineMath: [['$', '$'], ['\\(', '\\)']]
      },
      svg: {
        fontCache: 'global'
      }
    };
</script>

<script type="text/javascript" id="MathJax-script" async="" src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-svg.js">
</script>
<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.1/dist/js/bootstrap.bundle.min.js" integrity="sha384-HwwvtgBNo3bZJJLYd8oVXjrBZt8cqVSpeBNS5n7C8IVInixGAoxmnlMuBnhbgrkm" crossorigin="anonymous"></script>

<script>
  if (/.*?(\?|&)print-pdf/.test(window.location.toString())) {
      var ytVideos = document.getElementsByTagName("iframe")
      for (let i = 0; i < ytVideos.length; i++) {
          var videoFrame = ytVideos[i]
          var isYouTube = /^https?:\/\/(www.)youtube\.com\/.*/.test(videoFrame.src)
          if (isYouTube) {
              console.log(`Removing ${videoFrame.src}`)
              var parent = videoFrame.parentElement
              videoFrame.remove()
              var p = document.createElement('p')
              p.append(
                  document.createTextNode(
                      "There was an embedded video here, but it is disabled in the printed version of the slides."
                  )
              )
              p.append(document.createElement('br'))
              p.append(
                  document.createTextNode(
                      `Visit instead ${
                          videoFrame.src
                      } or ${
                          videoFrame.src.replace(
                              /(^https?:\/\/(www.)youtube\.com)\/(embed\/)(\w+).*/,
                              "https://www.youtube.com/watch?v=$4"
                          )
                      }`
                  )
              )
              parent.appendChild(p)
          }
      }
  }
</script>


    
  

</body></html>